import{c as n,a as e,b as m,d as l,F as p,r as b,w as c,e as h,v as g,o as d,f,t as r,g as v,h as u}from"./app-BFXy5JVw.js";import{U as _}from"./UserForm-LNSJeRlo.js";import{P as w}from"./Pagination-BEOn-jB3.js";import{R as y,u as k}from"./ReportGenerator-dRLaK6Hr.js";import{u as S}from"./users-DgYKCs5C.js";import{B as A}from"./BackBtn-DOVCGk6m.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./makeAxiosFactory-B9aoRd9L.js";const U={class:"list-group"},B={class:"fw-bold"},M={class:"badge bg-primary"},R={class:"text-muted mb-2"},C={class:"form-check form-switch"},$=["onChange","onUpdate:modelValue","id"],D=["for"],P={class:"dropdown"},E={class:"dropdown-menu dropdown-menu-end"},V=["onClick"],I=["onClick"],j=["onClick"],N={key:1,class:"alert alert-info mt-3"},F={class:"modal fade",id:"reportModal",tabindex:"-1"},G={class:"modal-dialog"},T={class:"modal-content"},W={class:"modal-body"},L={class:"modal fade",id:"roleSwitcherUserModal",tabindex:"-1"},O={class:"modal-dialog modal-lg"},q={class:"modal-content"},z={class:"modal-body"},H={class:"form-floating mb-2"},J={class:"modal fade",id:"editUserModal",tabindex:"-1"},K={class:"modal-dialog modal-lg"},Q={class:"modal-content"},X={class:"modal-body"},Y={name:"AdminList",data(){return{adminsStore:k(),userStore:S(),selectedAdmin:null}},created(){this.fetchData()},methods:{openRoleSwitcher(s){this.selectedAdmin=s,new bootstrap.Modal(document.getElementById("roleSwitcherUserModal")).show()},openEdit(s){this.selectedAdmin=s,new bootstrap.Modal(document.getElementById("editUserModal")).show()},async changeAdminWorkStatus(s){await this.userStore.updateWorkStatus(s.id,s.is_work)},async handleReport(s){s.user_id=this.selectedAdmin.id,await this.adminsStore.downloadPersonalAdminReport(s)},async fetchData(s=1){await this.adminsStore.fetchAdminsByPage(s).then(()=>{const t=bootstrap.Modal.getInstance(document.getElementById("editUserModal"));t&&t.hide()})},async fetchDataByUrl(s){await this.adminsStore.fetchByUrl(s)},async downloadReport(s){await this.adminsStore.downloadReport(s)},async changeRole(){await this.userStore.updateRole(this.selectedAdmin.id,this.selectedAdmin.role).then(()=>{this.fetchData(),bootstrap.Modal.getInstance(document.getElementById("roleSwitcherUserModal")).hide()})}}},Z=Object.assign(Y,{setup(s){return(t,o)=>(d(),n(p,null,[e("ul",U,[(d(!0),n(p,null,b(t.adminsStore.items,a=>(d(),n("li",{key:a.id,class:"list-group-item d-flex justify-content-between align-items-center"},[e("div",null,[e("div",B,[e("span",M,r(a.percent)+"%",1),f(" "+r(a.name),1)]),e("small",R,r(a.email),1),e("div",C,[h(e("input",{onChange:i=>t.changeAdminWorkStatus(a),class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>a.is_work=i,id:`is-work-${a.id}`},null,40,$),[[v,a.is_work]]),e("label",{class:"form-check-label",for:`is-work-${a.id}`},r(a.is_work?"работает":"не работает"),9,D)])]),e("div",P,[o[2]||(o[2]=e("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[e("i",{class:"fas fa-bars"})],-1)),e("ul",E,[e("li",null,[e("button",{type:"button",onClick:i=>t.selectedAdmin=a,class:"dropdown-item","data-bs-toggle":"modal","data-bs-target":"#reportModal"}," Сформировать отчет ",8,V)]),e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:c(i=>t.openRoleSwitcher(a),["prevent"])},"Сменить роль",8,I)]),e("li",null,[e("a",{class:"dropdown-item",href:"#",onClick:c(i=>t.openEdit(a),["prevent"])},"Редактировать",8,j)])])])]))),128))]),t.adminsStore.items.length>0?(d(),m(w,{key:0,pagination:t.adminsStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"])):l("",!0),t.adminsStore.items.length===0?(d(),n("div",N," Администраторов пока нет. ")):l("",!0),e("div",F,[e("div",G,[e("div",T,[o[3]||(o[3]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Отчет по администратору"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",W,[t.selectedAdmin?(d(),m(y,{key:0,type:"admins","is-simple":!0,"object-id":t.selectedAdmin.id,onGenerateReport:t.handleReport},null,8,["object-id","onGenerateReport"])):l("",!0)])])])]),e("div",L,[e("div",O,[e("div",q,[o[7]||(o[7]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Редактирование пользователя"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",z,[t.selectedAdmin?(d(),n("form",{key:0,onSubmit:o[1]||(o[1]=c((...a)=>t.changeRole&&t.changeRole(...a),["prevent"]))},[e("div",H,[h(e("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>t.selectedAdmin.role=a),class:"form-select",id:"role",required:""},[...o[4]||(o[4]=[e("option",{value:0},"Пользователь",-1),e("option",{value:1},"Младший администратор",-1),e("option",{value:2},"Поставщик",-1),e("option",{value:3},"Администратор",-1)])],512),[[g,t.selectedAdmin.role]]),o[5]||(o[5]=e("label",{for:"role"},"Роль",-1))]),o[6]||(o[6]=e("button",{type:"submit",class:"btn btn-primary w-100 p-3"}," Сохранить изменения ",-1))],32)):l("",!0)])])])]),e("div",J,[e("div",K,[e("div",Q,[o[8]||(o[8]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Редактирование администратора"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",X,[t.selectedAdmin?(d(),m(_,{key:0,initialData:t.selectedAdmin,onSaved:t.fetchData},null,8,["initialData","onSaved"])):l("",!0)])])])])],64))}}),x={class:"container-fluid p-3"},ee={class:"navbar fixed-bottom p-3"},te={methods:{goTo(s){this.$router.push({name:s})}}},me=Object.assign(te,{__name:"AdminPage",setup(s){return(t,o)=>(d(),n("div",x,[u(A),o[1]||(o[1]=e("h4",{class:"mb-3"},"Список администраторов",-1)),u(Z),e("nav",ee,[e("button",{type:"button",onClick:o[0]||(o[0]=a=>t.goTo("UserPage")),class:"btn btn-primary p-3 w-100"},"Добавить администратора ")])]))}});export{me as default};
