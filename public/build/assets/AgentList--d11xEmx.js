import{c as m,o as l,a as t,f as u,t as a,F as b,i as A,e as c,j as f,w as p,h as $,r as S,b as y,d as h}from"./app-BFXy5JVw.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as E}from"./Pagination-BEOn-jB3.js";import{m as d}from"./makeAxiosFactory-B9aoRd9L.js";const C={name:"AgentInfo",props:{agent:{type:Object,required:!0}}},I={class:"list-group list-group-flush"},B={class:"list-group-item"},M={class:"list-group-item"},_={class:"list-group-item"},D={class:"list-group-item"},F={class:"list-group-item"};function P(o,e,s,n,i,g){return l(),m(b,null,[t("ul",I,[t("li",B,[e[1]||(e[1]=t("strong",null,"ID:",-1)),u(" "+a(s.agent.id),1)]),t("li",M,[e[2]||(e[2]=t("strong",null,"Имя:",-1)),u(" "+a(s.agent.name),1)]),t("li",_,[e[3]||(e[3]=t("strong",null,"Телефон:",-1)),u(" "+a(s.agent.phone),1)]),t("li",D,[e[4]||(e[4]=t("strong",null,"Email:",-1)),u(" "+a(s.agent.email),1)]),t("li",F,[e[5]||(e[5]=t("strong",null,"Регион:",-1)),u(" "+a(s.agent.region),1)])]),t("button",{class:"btn btn-primary p-3 w-100",onClick:e[0]||(e[0]=gt=>o.$emit("edit",s.agent))},"Редактировать")],64)}const T=k(C,[["render",P]]),r="/bot-api/agents",v=A("agents",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:o=>e=>o.items.find(s=>s.id===e)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:o}=await d(`${r}`,"GET");this.items=o}catch(o){this.error=(o==null?void 0:o.message)||"Failed to load agents"}finally{this.loading=!1}},async fetchAllByPage(o=1){const{data:e}=await d(`${r}?page=${o}`,"GET");this.items=e.data,this.pagination=e},async fetchByUrl(o){const{data:e}=await d(o,"GET");this.items=e.data,this.pagination=e},async fetchOne(o){try{const{data:e}=await d(`${r}/${o}`,"GET");return e}catch(e){throw this.error=(e==null?void 0:e.message)||"Failed to load agent",e}},async create(o){const{data:e}=await d(`${r}`,"POST",o);return this.items.push(e),e},async update(o,e){const{data:s}=await d(`${r}/${o}`,"PUT",e),n=this.items.findIndex(i=>i.id===o);return n!==-1&&(this.items[n]=s),s},async remove(o){await d(`${r}/${o}`,"DELETE"),this.items=this.items.filter(e=>e.id!==o)},async downloadSelReport(o){var e,s;this.loading=!0,this.error=null;try{const{data:n}=await d(`${r}/download-self-report`,"POST",o);return n}catch(n){throw this.error=((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.message)??"Ошибка отправки отчёта",n}finally{this.loading=!1}}}}),U={class:"form-floating mb-2"},V={class:"form-floating mb-2"},O={class:"form-floating mb-2"},j={class:"form-floating mb-2"},q={name:"AgentForm",props:{initialData:{type:Object,default:null}},data(){return{agentStore:v(),isEdit:!1,form:{name:"",phone:"",email:"",region:""}}},created(){this.initialData&&(this.form={...this.initialData},this.isEdit=!0)},methods:{async submitForm(){this.isEdit?this.agentStore.update(this.form.id,this.form):this.agentStore.create(this.form),this.$emit("callback")}}},w=Object.assign(q,{setup(o){return(e,s)=>(l(),m("form",{onSubmit:s[4]||(s[4]=p((...n)=>e.submitForm&&e.submitForm(...n),["prevent"]))},[t("div",U,[c(t("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>e.form.name=n),type:"text",class:"form-control",id:"name",placeholder:"Имя",required:""},null,512),[[f,e.form.name]]),s[5]||(s[5]=t("label",{for:"name"},"Имя",-1))]),t("div",V,[c(t("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>e.form.phone=n),type:"tel",class:"form-control",id:"phone",placeholder:"Телефон",required:""},null,512),[[f,e.form.phone]]),s[6]||(s[6]=t("label",{for:"phone"},"Телефон",-1))]),t("div",O,[c(t("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>e.form.email=n),type:"email",class:"form-control",id:"email",placeholder:"Email",required:""},null,512),[[f,e.form.email]]),s[7]||(s[7]=t("label",{for:"email"},"Email",-1))]),t("div",j,[c(t("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>e.form.region=n),type:"text",class:"form-control",id:"region",placeholder:"Регион",required:""},null,512),[[f,e.form.region]]),s[8]||(s[8]=t("label",{for:"region"},"Регион",-1))]),s[9]||(s[9]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Сохранить",-1))],32))}}),L={class:"form-floating mb-3"},G={class:"list-group"},N=["onClick"],R={class:"fw-bold"},W={class:"text-muted"},z={class:"dropdown"},H={class:"dropdown-menu dropdown-menu-end"},J={key:0},K=["onClick"],Q=["onClick"],X=["onClick"],Y=["onClick"],Z={class:"modal fade",id:"agentInfoModal",tabindex:"-1"},x={class:"modal-dialog"},tt={class:"modal-content"},et={class:"modal-body"},st={class:"modal fade",id:"deleteModal",tabindex:"-1"},ot={class:"modal-dialog"},nt={class:"modal-content"},it={class:"modal-body"},lt={class:"modal-footer"},at={class:"modal fade",id:"editAgentModal",tabindex:"-1"},dt={class:"modal-dialog modal-lg"},rt={class:"modal-content"},mt={class:"modal-body"},ut={name:"SupplierListWithDropdown",components:{AgentForm:w},props:["forSelect"],data(){return{search:"",agentStore:v(),selectedAgent:null}},computed:{filteredAgents(){if(!this.search)return this.agentStore.items||[];const o=this.search.toLowerCase();return this.agentStore.items.filter(e=>Object.values(e).some(s=>s?String(s).toLowerCase().includes(o):!1))}},created(){this.fetchAgents()},methods:{async fetchAgents(o=1){await this.agentStore.fetchAllByPage(o)},async fetchAgentsByUrl(o){await this.agentStore.fetchByUrl(o)},selectAgent(o){this.forSelect&&this.$emit("select",o)},openAgentInfo(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("agentInfoModal")).show()},openPercents(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("percentsModal")).show()},confirmDelete(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("deleteModal")).show()},async deleteAgent(){try{await this.agentStore.remove(this.selectedAgent.id),bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide()}catch(o){console.error("Ошибка удаления:",o)}},openEditAgent(o){this.selectedAgent=o,new bootstrap.Modal(document.getElementById("editAgentModal")).show()}}},bt=Object.assign(ut,{setup(o){return(e,s)=>{var n;return l(),m(b,null,[t("div",L,[c(t("input",{type:"search","onUpdate:modelValue":s[0]||(s[0]=i=>e.search=i),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[f,e.search]]),s[2]||(s[2]=t("label",{for:"searchInput"},"Поиск",-1))]),t("ul",G,[(l(!0),m(b,null,S(e.filteredAgents,i=>(l(),m("li",{key:i.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",{onClick:g=>e.selectAgent(i)},[t("div",R,a(i.name),1),t("small",W,a(i.phone)+" | "+a(i.email),1)],8,N),t("div",z,[s[4]||(s[4]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",H,[o.forSelect?(l(),m("li",J,[t("a",{class:"dropdown-item",href:"#",onClick:p(g=>e.selectAgent(i),["prevent"])},"Выбрать",8,K)])):h("",!0),o.forSelect?h("",!0):(l(),m(b,{key:1},[t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:p(g=>e.openAgentInfo(i),["prevent"])},"Просмотр",8,Q)]),t("li",null,[t("a",{class:"dropdown-item",href:"#",onClick:p(g=>e.openEditAgent(i),["prevent"])},"Редактировать",8,X)]),s[3]||(s[3]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"#",onClick:p(g=>e.confirmDelete(i),["prevent"])},"Удалить",8,Y)])],64))])])]))),128))]),$(E,{pagination:e.agentStore.pagination,onPageChanged:e.fetchAgentsByUrl},null,8,["pagination","onPageChanged"]),t("div",Z,[t("div",x,[t("div",tt,[s[5]||(s[5]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",et,[e.selectedAgent?(l(),y(T,{key:0,agent:e.selectedAgent},null,8,["agent"])):h("",!0)])])])]),t("div",st,[t("div",ot,[t("div",nt,[s[9]||(s[9]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title text-danger"},"Удаление"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",it,[s[6]||(s[6]=u(" Вы уверены, что хотите удалить ",-1)),t("strong",null,a((n=e.selectedAgent)==null?void 0:n.name),1),s[7]||(s[7]=u("? ",-1))]),t("div",lt,[s[8]||(s[8]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Отмена",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:s[1]||(s[1]=(...i)=>e.deleteAgent&&e.deleteAgent(...i))},"Удалить")])])])]),t("div",at,[t("div",dt,[t("div",rt,[s[10]||(s[10]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",mt,[e.selectedAgent?(l(),y(w,{key:0,initialData:e.selectedAgent,onSaved:e.fetchSuppliers},null,8,["initialData","onSaved"])):h("",!0)])])])])],64)}}});export{bt as _,w as a,v as u};
