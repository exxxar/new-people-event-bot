import{B as p}from"./BackBtn-DOVCGk6m.js";import{i as f,c as a,a as r,e as b,j as _,d as g,F as h,r as u,o,t as n,h as y}from"./app-BFXy5JVw.js";import{m as k}from"./makeAxiosFactory-B9aoRd9L.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as x}from"./baseExports-B5V0AM2v.js";const S="/bot-api/birthdays",v=f("birthdays",{state:()=>({items:[],loading:!1,error:null}),getters:{byType:e=>t=>e.items.filter(s=>s.type===t),today:e=>e.items.filter(t=>t.date===new Date().toISOString().split("T")[0])},actions:{async fetchNextWeek(){this.loading=!0,this.error=null;try{const{data:e}=await k(S,"POST");this.items=e}catch(e){this.error=(e==null?void 0:e.message)||"Failed to load birthdays"}finally{this.loading=!1}}}}),w={name:"BirthdayList",data(){return{search:"",birthdayStore:v()}},computed:{filteredBirthdays(){if(!this.search)return this.birthdayStore.items||[];const e=this.search.toLowerCase();return this.birthdayStore.items.filter(t=>Object.values(t).some(s=>s?String(s).toLowerCase().includes(e):!1))},grouped(){const e={};return this.filteredBirthdays.forEach(t=>{const s=t.date.slice(5);e[s]||(e[s]={key:s,date:t.date,weekday:t.weekday,items:[]}),e[s].items.push(t)}),Object.values(e).sort((t,s)=>t.key.localeCompare(s.key))}},created(){this.fetchBirthdays()},methods:{async fetchBirthdays(){await this.birthdayStore.fetchNextWeek()},formatDate(e){return new Date(e).toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}}},L={class:"form-floating mb-2"},j={key:0,class:"text-center py-4"},D={key:1},C={key:0,class:"text-muted"},N={class:"border-bottom pb-1 mb-3"},O={class:"list-group"},F={class:"fw-bold"},I={class:"text-muted"},T={class:"badge bg-primary"};function V(e,t,s,m,l,c){return o(),a(h,null,[t[3]||(t[3]=r("h6",{class:"mb-3"},"Ближайшие дни рождения",-1)),r("div",L,[b(r("input",{type:"search","onUpdate:modelValue":t[0]||(t[0]=i=>l.search=i),class:"form-control",id:"searchInput",placeholder:"Поиск..."},null,512),[[_,l.search]]),t[1]||(t[1]=r("label",{for:"searchInput"},"Поиск",-1))]),l.birthdayStore.loading?(o(),a("div",j,[...t[2]||(t[2]=[r("div",{class:"spinner-border text-primary"},null,-1)])])):(o(),a("div",D,[c.grouped.length===0?(o(),a("div",C," В ближайшую неделю именинников нет ")):g("",!0),(o(!0),a(h,null,u(c.grouped,i=>(o(),a("div",{key:i.date,class:"mb-2"},[r("h5",N,n(c.formatDate(i.date))+" — "+n(i.weekday),1),r("ul",O,[(o(!0),a(h,null,u(i.items,d=>(o(),a("li",{key:d.name+d.type,class:"list-group-item d-flex justify-content-between align-items-center"},[r("div",null,[r("div",F,n(d.name),1),r("small",I,n(d.type==="пользователь"?"Сотрудник":"Поставщик"),1)]),r("span",T,n(d.weekday),1)]))),128))])]))),128))]))],64)}const E=B(w,[["render",V],["__scopeId","data-v-80b3dde7"]]),P={class:"container-fluid p-3"},U=["disabled"],W={name:"BirthdayPage",data(){return{jobStore:x()}},methods:{exportBirthdaysList(){this.jobStore.exportBirthdaysList()}}},z=Object.assign(W,{setup(e){return(t,s)=>(o(),a("div",P,[y(p),y(E),r("button",{type:"button",disabled:t.jobStore.loading,class:"btn btn-outline-light text-primary w-100 p-3",onClick:s[0]||(s[0]=m=>t.exportBirthdaysList())}," Выгрузить список в эксель ",8,U)]))}});export{z as default};
