import{b as g,o as l,k as y,a as e,c as i,d,n as k,f as S,t as c,z as x,I as C,u as f,F as v,e as b,g as $,J as M,j as p,w as T,h,G as U,p as j,Z as L,H as V}from"./app-BFXy5JVw.js";import{_ as w}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as P}from"./useConfitmModalStore-3K6mUG_C.js";import{u as _}from"./users-DgYKCs5C.js";import"./makeAxiosFactory-B9aoRd9L.js";const B={name:"GlobalAlert",setup(){return{alertStore:C()}},computed:{alertClass(){switch(this.alertStore.type){case"success":return"alert-success";case"error":return"alert-error";default:return"alert-info"}}}},D={class:"wrapper-alert"};function E(o,t,s,a,r,u){return l(),g(x,{name:"fade"},{default:y(()=>[e("div",D,[a.alertStore.visible?(l(),i("div",{key:0,class:k(["global-alert",u.alertClass])},[S(c(a.alertStore.message)+" ",1),e("button",{class:"close-btn",onClick:t[0]||(t[0]=(...m)=>a.alertStore.hide&&a.alertStore.hide(...m))},"×")],2)):d("",!0)])]),_:1})}const A=w(B,[["render",E],["__scopeId","data-v-81bbd0b4"]]),F={class:"modal-dialog"},O={class:"modal-content"},z={class:"modal-header"},I={class:"modal-body"},N=["innerHTML"],W={class:"modal-footer"},q={},G=Object.assign(q,{__name:"GlobalConfirmModal",setup(o){const t=P();return(s,a)=>f(t).show?(l(),i("div",{key:0,class:k(["modal fade",{show:f(t).show}]),tabindex:"-1",style:{display:"block"}},[e("div",F,[e("div",O,[e("div",z,[a[3]||(a[3]=e("h5",{class:"modal-title"},"Подтверждение",-1)),e("button",{type:"button",class:"btn-close",onClick:a[0]||(a[0]=r=>f(t).close())})]),e("div",I,[e("p",{innerHTML:f(t).message},null,8,N)]),e("div",W,[e("button",{class:"btn btn-success",onClick:a[1]||(a[1]=r=>f(t).confirm())},"Подтвердить"),e("button",{class:"btn btn-danger",onClick:a[2]||(a[2]=r=>f(t).reject())},"Отклонить")])])])],2)):d("",!0)}}),H={name:"UserProfileCard",data(){return{userStore:_(),minimize:!0}},props:{user:{type:Object,required:!0}},mounted(){console.log("user in usercard",this.user)},methods:{async changeAdminWorkStatus(o){await this.userStore.updateWorkStatus(o.id,o.is_work)},roleLabel(o){return{0:"Пользователь",1:"Младший администратор",2:"Поставщик",3:"Администратор",4:"Суперадмин"}[o]||"Неизвестно"}}},R={class:"card border-light border-2"},J={class:"card-body d-flex justify-content-center flex-column align-items-center"},Z={class:"mb-1 fst-italic small text-primary fw-bold"},K={class:"text-muted mb-0"},Q={key:0,class:"mb-1"},X={class:"mb-1"},Y={class:"form-check form-switch"},ee=["id"],te=["for"];function se(o,t,s,a,r,u){return l(),i("div",R,[e("div",J,[e("h5",{onClick:t[0]||(t[0]=m=>r.minimize=!r.minimize),class:"card-title mb-0 text-decoration-underline link-underline-primary"},c(s.user.name),1),e("p",Z,c(u.roleLabel(s.user.role)),1),r.minimize?d("",!0):(l(),i(v,{key:0},[e("p",K,c(s.user.fio_from_telegram||"—"),1),s.user.telegram_chat_id?(l(),i("p",Q,c(s.user.telegram_chat_id),1)):d("",!0),s.user.role>=3?(l(),i(v,{key:1},[e("p",X," Админский "+c(s.user.percent)+" % ",1),e("div",Y,[b(e("input",{onChange:t[1]||(t[1]=m=>u.changeAdminWorkStatus(s.user)),class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=m=>s.user.is_work=m),id:`is-work-${s.user.id}`},null,40,ee),[[$,s.user.is_work]]),e("label",{class:"form-check-label",for:`is-work-${s.user.id}`},c(s.user.is_work?"за работай":"не работаю"),9,te)])],64)):d("",!0)],64))])])}const oe=w(H,[["render",se]]),re={name:"PrimaryForm",props:{initialData:{type:Object,default:null}},data(){return{userStore:_(),selectedRole:_().self.role||0,form:{name:"",email:"",birthday:"",password:"",phone:"",region:""}}},created(){this.initialData&&(this.form={...this.initialData},this.form.birthday=new Date(this.form.birthday).toISOString().slice(0,10),this.isEdit=!0)},methods:{async submitForm(){try{await this.userStore.createPrimary(this.form).then(()=>{this.$emit("callback")})}catch(o){console.error(o)}}}},ae={class:"form-floating mb-2"},le={class:"form-floating mb-2"},ne={class:"form-floating mb-2"},ie={class:"form-floating mb-2"},de={key:0,class:"form-floating mb-2"};function ue(o,t,s,a,r,u){const m=M("mask");return l(),i("form",{onSubmit:t[5]||(t[5]=T((...n)=>u.submitForm&&u.submitForm(...n),["prevent"]))},[t[11]||(t[11]=e("p",{class:"alert alert-primary"}," Необходимо заполнить информацию о себе! ",-1)),e("div",ae,[b(e("input",{type:"text",required:"","onUpdate:modelValue":t[0]||(t[0]=n=>r.form.name=n),class:"form-control",placeholder:"Имя"},null,512),[[p,r.form.name]]),t[6]||(t[6]=e("label",null,"Имя",-1))]),e("div",le,[b(e("input",{type:"text",required:"","onUpdate:modelValue":t[1]||(t[1]=n=>r.form.phone=n),class:"form-control",placeholder:"Телефон"},null,512),[[m,"+7(###) ###-##-##"],[p,r.form.phone]]),t[7]||(t[7]=e("label",null,"Телефон",-1))]),e("div",ne,[b(e("input",{type:"email","onUpdate:modelValue":t[2]||(t[2]=n=>r.form.email=n),class:"form-control",placeholder:"Email"},null,512),[[p,r.form.email]]),t[8]||(t[8]=e("label",null,"Email",-1))]),e("div",ie,[b(e("input",{required:"",type:"date","onUpdate:modelValue":t[3]||(t[3]=n=>r.form.birthday=n),class:"form-control"},null,512),[[p,r.form.birthday]]),t[9]||(t[9]=e("label",null,"Дата рождения",-1))]),r.selectedRole===1?(l(),i("div",de,[b(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=n=>r.form.agent.region=n),class:"form-control",placeholder:"Регион"},null,512),[[p,r.form.agent.region]]),t[10]||(t[10]=e("label",null,"Регион",-1))])):d("",!0),t[12]||(t[12]=e("button",{type:"submit",class:"btn btn-primary w-100 p-3"}," Сохранить ",-1))],32)}const me=w(re,[["render",ue]]),ce={class:"text-body-secondary",style:{padding:"0px 0px 90px 0px"}},fe={class:"container d-flex justify-content-center flex-column align-items-center"},be={class:"d-flex justify-content-center my-3"},pe={class:"offcanvas offcanvas-start custom-offcanvas",style:{width:"70%","border-radius":"0px 10px 10px 0px"},tabindex:"-1",id:"sidebar-menu","aria-labelledby":"offcanvasExampleLabel"},_e={class:"offcanvas-body"},he={class:"list-group list-group-flush my-3"},ge={class:"p-2 list-group-item"},ve={class:"modal fade",id:"primaryUserModal",tabindex:"-1"},ye={class:"modal-dialog modal-lg"},ke={class:"modal-content"},we={class:"modal-body"},Se={data(){return{userStore:_(),currentTheme:"",themes:[]}},watch:{},created(){this.userStore.fetchSelf().then(()=>{!this.userStore.self.registration_at&&this.userStore.self.role>0&&new bootstrap.Modal(document.getElementById("primaryUserModal")).show()})},computed:{tg(){return window.Telegram.WebApp},self(){return window.botUser||null}},mounted(){this.tg.expand(),this.tg.BackButton.hide()},methods:{result(){const o=bootstrap.Modal.getInstance(document.getElementById("primaryUserModal"));o&&o.hide()},goTo(o){this.$router.push({name:o})},scrollTop(){window.scrollTo(0,80)},openLink(o){this.tg.openLink(o,{try_instant_view:!0})},closeShop(){this.tg.close()}}},xe=Object.assign(Se,{__name:"Layout",setup(o){return(t,s)=>(l(),i(v,null,[h(f(L),null,{default:y(()=>[...s[2]||(s[2]=[e("title",null,"Автоматический учет доставки",-1),e("meta",{name:"description",content:"CashMan - система твоего бизнеса внутри"},null,-1)])]),_:1}),s[6]||(s[6]=U('<header class="fixed-top-menu" data-bs-theme="dark"><div class="navbar shadow shadow-sm"><div class="container flex-row-reverse p-2"><span data-bs-toggle="modal" data-bs-target="#bot-info-modal" class="text-primary fw-bold cursor-pointer">Система управления доставками</span><button class="btn btn-link rounded-0 border-0 p-1" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar-menu" aria-controls="sidebar-menu"><i class="fa-solid fa-bars"></i></button></div></div></header>',1)),h(A),h(G),j(t.$slots,"default"),e("footer",ce,[e("div",fe,[e("p",be,[e("a",{href:"javascript:void(0)",onClick:s[0]||(s[0]=(...a)=>t.scrollTop&&t.scrollTop(...a))},[...s[3]||(s[3]=[e("i",{class:"fa-solid fa-arrow-up mr-2"},null,-1),S("Вернуться наверх",-1)])])])])]),e("div",pe,[s[4]||(s[4]=e("div",{class:"offcanvas-header"},[e("h6",{class:"offcanvas-title",id:"offcanvasExampleLabel"},"Меню"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1)),e("div",_e,[t.userStore.self?(l(),g(oe,{key:0,user:t.userStore.self},null,8,["user"])):d("",!0),e("ul",he,[e("li",ge,[e("a",{"data-bs-dismiss":"offcanvas",class:k([{"fw-bold":t.$route.name==="MenuPage"},"text-decoration-none fw-normal"]),onClick:s[1]||(s[1]=a=>t.goTo("MenuPage")),href:"javascript:void(0)"}," Главное меню",2)])])])]),e("div",ve,[e("div",ye,[e("div",ke,[s[5]||(s[5]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Первичная заполнение информации"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",we,[t.userStore.self?(l(),g(me,{key:0,onCallback:t.result,"initial-data":t.userStore.self},null,8,["onCallback","initial-data"])):d("",!0)])])])])],64))}}),Ce={key:1,class:"container py-3"},$e={data(){return{userStore:_()}},created(){this.userStore.fetchSelf()},computed:{tg(){return window.Telegram.WebApp},tgUser(){const o=new URLSearchParams(this.tg.initData);return JSON.parse(o.get("user"))}},mounted(){},methods:{open(o){this.tg.openLink(o)},goTo(o){this.$router.push({name:o})}}},Ve=Object.assign($e,{__name:"Main",setup(o){return(t,s)=>{var r;const a=V("router-view");return(r=t.userStore.self)!=null&&r.blocked_at?(l(),i("div",Ce,[...s[0]||(s[0]=[e("p",{class:"alert alert-light text-center"}," Доступ ограничен ",-1)])])):(l(),g(xe,{key:0},{default:y(()=>[h(a)]),_:1}))}}});export{Ve as default};
