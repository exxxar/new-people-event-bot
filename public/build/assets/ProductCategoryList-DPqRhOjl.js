import{i as b,c as d,a as s,e as y,j as C,t as m,w as u,I as w,o as r,h as S,d as c,F as p,r as $,f,b as k,n as E}from"./app-BFXy5JVw.js";import{P as M}from"./Pagination-BEOn-jB3.js";import{m as l}from"./makeAxiosFactory-B9aoRd9L.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as P}from"./useConfitmModalStore-3K6mUG_C.js";const n="/bot-api/product-categories",v=b("productCategories",{state:()=>({items:[],loading:!1,error:null}),getters:{byId:e=>t=>e.items.find(o=>o.id===t)},actions:{async fetchAll(){this.loading=!0,this.error=null;try{const{data:e}=await l(`${n}`,"GET");this.items=e}catch(e){this.error=(e==null?void 0:e.message)||"Failed to load categories"}finally{this.loading=!1}},async fetchProductsByCategory(e=1){const{data:t}=await l(`${n}/with-products?page=${e}`,"GET");this.items=t.data,this.pagination=t},async loadMoreProductsInCategory(e,t){const{data:o}=await l(`${n}/fetch-next-products/${e}/products?page=${t}`,"GET");this.items.find(a=>a.id===e).products.push(...o.data)},async fetchAllByPage(e=1){const{data:t}=await l(`${n}?page=${e}`,"GET");this.items=t.data,this.pagination=t},async fetchByUrl(e){const{data:t}=await l(e,"GET");this.items=t.data,this.pagination=t},async fetchOne(e){try{const{data:t}=await l(`${n}/${e}`,"GET");return t}catch(t){throw this.error=(t==null?void 0:t.message)||"Failed to load category",t}},async create(e){const{data:t}=await l(`${n}`,"POST",e);return this.items.push(t),t},async removeAll(e){await l(`${n}/remove-all`,"POST",{ids:e}),e.forEach(t=>{this.items=this.items.filter(o=>o.id!==t)})},async update(e,t){const{data:o}=await l(`${n}/${e}`,"PUT",t),i=this.items.findIndex(a=>a.id===e);return i!==-1&&(this.items[i]=o),o},async remove(e){await l(`${n}/${e}`,"DELETE"),this.items=this.items.filter(t=>t.id!==e)}}}),D={name:"ProductCategoryForm",props:{initialData:{type:Object,default:null}},data(){return{alertStore:w(),productCategoryStore:v(),form:{name:"",description:""},isEdit:!1}},created(){this.initialData&&(this.form={...this.initialData},this.isEdit=!0)},methods:{async submitForm(){try{this.isEdit?await this.productCategoryStore.update(this.form.id,this.form).then(()=>{this.alertStore.show("Категория успешно обновлена","success")}):await this.productCategoryStore.create(this.form).then(()=>{this.alertStore.show("Категория успешно создана","success")}),this.$emit("saved")}catch(e){console.error("Ошибка сохранения категории:",e)}}}},B={class:"form-floating mb-2"},A={class:"form-floating mb-2"},T={type:"submit",class:"btn btn-primary w-100 p-3"};function F(e,t,o,i,a,g){return r(),d("form",{onSubmit:t[2]||(t[2]=u((...h)=>g.submitForm&&g.submitForm(...h),["prevent"]))},[s("div",B,[y(s("input",{"onUpdate:modelValue":t[0]||(t[0]=h=>a.form.name=h),type:"text",class:"form-control",id:"name",placeholder:"Название категории",required:""},null,512),[[C,a.form.name]]),t[3]||(t[3]=s("label",{for:"name"},"Название категории",-1))]),s("div",A,[y(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=h=>a.form.description=h),class:"form-control",id:"description",placeholder:"Описание категории",style:{height:"120px"},required:""},null,512),[[C,a.form.description]]),t[4]||(t[4]=s("label",{for:"description"},"Описание категории",-1))]),s("button",T,m(a.isEdit?"Сохранить изменения":"Добавить категорию"),1)],32)}const I=_(D,[["render",F]]),V={class:"d-flex"},O={class:"list-group"},U=["onClick"],j={class:"fw-bold"},G={class:"text-muted"},x={class:"dropdown"},N={class:"dropdown-menu dropdown-menu-end"},L={key:0},q=["onClick"],z=["onClick"],H=["onClick"],J=["onClick"],K={key:0,class:"alert alert-info mt-3"},Q={class:"modal fade",id:"viewCategoryModal",tabindex:"-1"},R={class:"modal-dialog"},W={class:"modal-content"},X={class:"modal-body"},Y={key:0},Z={class:"modal fade",id:"editCategoryModal",tabindex:"-1"},tt={class:"modal-dialog"},et={class:"modal-content"},st={class:"modal-body"},ot={name:"ProductCategoryList",props:["forSelect"],data(){return{modalStore:P(),productCategoryStore:v(),selectedCategory:null,selection:[]}},created(){this.fetchData()},methods:{removeAll(){this.modalStore.open("Вы уверены, что хотите удалить все выбранные элементы?",()=>{this.productCategoryStore.removeAll(this.selection),this.selection=[]},()=>{this.modalStore.close(),this.selection=[]})},toggleSelection(e){if(this.forSelect){this.$emit("select",e);return}let t=this.selection.findIndex(o=>o===e.id);t===-1?this.selection.push(e.id):this.selection.splice(t,1)},selectAll(){this.selection.length===0?this.productCategoryStore.items.forEach(e=>{this.selection.indexOf(e.id)===-1&&this.selection.push(e.id)}):this.selection=[]},async fetchData(e=1){const t=bootstrap.Modal.getInstance(document.getElementById("editCategoryModal"));t&&t.hide(),await this.productCategoryStore.fetchAllByPage(e)},async fetchDataByUrl(e){await this.productCategoryStore.fetchByUrl(e)},openViewModal(e){this.selectedCategory=e,new bootstrap.Modal(document.getElementById("viewCategoryModal")).show()},openEditModal(e){this.selectedCategory=null,this.$nextTick(()=>{this.selectedCategory=e,new bootstrap.Modal(document.getElementById("editCategoryModal")).show()})},openDeleteModal(e){this.selectedCategory=e,this.modalStore.open(`Вы уверены, что хотите удалить ${this.selectedCategory.name}?`,()=>{this.productCategoryStore.remove(this.selectedCategory.id),this.selection=[],this.fetchData()},()=>{this.modalStore.close(),this.selection=[]})}}},dt=Object.assign(ot,{setup(e){return(t,o)=>(r(),d(p,null,[s("div",V,[s("a",{href:"javascript:void(0)",onClick:o[0]||(o[0]=(...i)=>t.selectAll&&t.selectAll(...i)),class:"small"},"Выделить все"),t.selection.length>0?(r(),d("a",{key:0,href:"javascript:void(0)",onClick:o[1]||(o[1]=(...i)=>t.removeAll&&t.removeAll(...i)),class:"small text-danger mx-2"},"Удалить выделенное")):c("",!0)]),s("ul",O,[(r(!0),d(p,null,$(t.productCategoryStore.items,i=>(r(),d("li",{key:i.id,class:E([{"border-primary":t.selection.indexOf(i.id)!==-1},"list-group-item d-flex justify-content-between align-items-center"])},[s("div",{onClick:a=>t.toggleSelection(i)},[s("div",j,m(i.name),1),s("small",G,m(i.description),1)],8,U),s("div",x,[o[2]||(o[2]=s("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[s("i",{class:"fas fa-bars"})],-1)),s("ul",N,[e.forSelect?(r(),d("li",L,[s("a",{class:"dropdown-item",href:"#",onClick:u(a=>t.$emit("select",i),["prevent"])},"Выбрать",8,q)])):c("",!0),e.forSelect?c("",!0):(r(),d(p,{key:1},[s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:u(a=>t.openViewModal(i),["prevent"])},"Просмотреть",8,z)]),s("li",null,[s("a",{class:"dropdown-item",href:"#",onClick:u(a=>t.openEditModal(i),["prevent"])},"Редактировать",8,H)]),s("li",null,[s("a",{class:"dropdown-item text-danger",href:"#",onClick:u(a=>t.openDeleteModal(i),["prevent"])},"Удалить",8,J)])],64))])])],2))),128))]),S(M,{pagination:t.productCategoryStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.productCategoryStore.items.length===0?(r(),d("div",K," Категорий пока нет. ")):c("",!0),s("div",Q,[s("div",R,[s("div",W,[o[6]||(o[6]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Просмотр категории"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",X,[t.selectedCategory?(r(),d("div",Y,[s("p",null,[o[3]||(o[3]=s("strong",null,"Название:",-1)),f(" "+m(t.selectedCategory.name),1)]),s("p",null,[o[4]||(o[4]=s("strong",null,"Описание:",-1)),f(" "+m(t.selectedCategory.description),1)]),s("p",null,[o[5]||(o[5]=s("strong",null,"ID:",-1)),f(" "+m(t.selectedCategory.id),1)])])):c("",!0)])])])]),s("div",Z,[s("div",tt,[s("div",et,[o[7]||(o[7]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title"},"Редактирование категории"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),s("div",st,[t.selectedCategory?(r(),k(I,{key:0,"initial-data":t.selectedCategory,onSaved:t.fetchData},null,8,["initial-data","onSaved"])):c("",!0)])])])])],64))}});export{I as P,dt as _,v as u};
