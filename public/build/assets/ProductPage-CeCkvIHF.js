import{P as h,_ as f,a as C}from"./ProductList-7HlIsf5E.js";import{u as v}from"./baseExports-B5V0AM2v.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as l,a as e,F as c,o as n,h as m,d as r,r as g,b,t as p,w as y,i as $,I as M,L as w}from"./app-BFXy5JVw.js";import{u as S,_ as E,P as B}from"./ProductCategoryList-DPqRhOjl.js";import{P as k}from"./Pagination-BEOn-jB3.js";import{u as x}from"./SupplierList-DrYW336K.js";import{B as I}from"./BackBtn-DOVCGk6m.js";import"./makeAxiosFactory-B9aoRd9L.js";import"./useConfitmModalStore-3K6mUG_C.js";const j={data(){return{jobStore:v()}},methods:{selectMenu(o){this.$emit("select",o)},exportProducts(o){this.jobStore.exportProducts(o)}}},D={class:"btn-group-vertical w-100",role:"group","aria-label":"Вертикальное меню"},U={class:"dropdown mt-2"},F={class:"dropdown-menu w-100"},V=["disabled"],z=["disabled"],T=["disabled"];function N(o,t,s,a,i,d){return n(),l(c,null,[e("div",D,[e("button",{type:"button",onClick:t[0]||(t[0]=u=>d.selectMenu("products")),class:"btn btn-outline-primary p-3"},"Общий список товаров "),e("button",{type:"button",onClick:t[1]||(t[1]=u=>d.selectMenu("products-by-supplier")),class:"btn btn-outline-primary p-3"},"Список товаров по поставщикам "),e("button",{type:"button",onClick:t[2]||(t[2]=u=>d.selectMenu("products-by-categories")),class:"btn btn-outline-primary p-3"},"Список товаров по категориям "),e("button",{type:"button",onClick:t[3]||(t[3]=u=>d.selectMenu("categories")),class:"btn btn-outline-primary p-3"},"Список категорий товаров "),e("button",{onClick:t[4]||(t[4]=u=>d.selectMenu("import-products")),type:"button",class:"btn btn-outline-primary p-3"},"Загрузить прайс с товарами и категориями ")]),e("div",U,[t[8]||(t[8]=e("button",{class:"btn btn-outline-primary p-3 dropdown-toggle w-100",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"}," Скачать таблицу с товарами ",-1)),e("ul",F,[e("li",null,[e("button",{type:"button",disabled:i.jobStore.loading,class:"dropdown-item",onClick:t[5]||(t[5]=u=>d.exportProducts(0))}," Список всех товаров ",8,V)]),e("li",null,[e("button",{type:"button",disabled:i.jobStore.loading,onClick:t[6]||(t[6]=u=>d.exportProducts(1)),class:"dropdown-item"}," Список по категориям ",8,z)]),e("li",null,[e("button",{type:"button",disabled:i.jobStore.loading,onClick:t[7]||(t[7]=u=>d.exportProducts(2)),class:"dropdown-item"}," Список по поставщикам ",8,T)])])])],64)}const O=P(j,[["render",N]]),W={class:"card-header"},L={class:"mb-0"},A={class:"card-body"},q={key:0,class:"text-muted small"},G={key:1,class:"text-muted small"},H={class:"list-group list-group-flush"},J=["onClick"],K={key:0,class:"badge bg-success mb-0"},Q={key:2,class:"mt-3 text-center"},R=["onClick"],X={key:0,class:"alert alert-info mt-3"},Y={class:"modal fade",id:"viewProductModal",tabindex:"-1"},Z={class:"modal-dialog modal-lg"},tt={class:"modal-content"},et={class:"modal-body"},ot={name:"Suppliers",components:{ProductCard:h},data(){return{supplierStore:x(),selectedProduct:null,pageMap:{}}},mounted(){this.fetchSuppliers()},methods:{async fetchDataByUrl(o){await this.supplierStore.fetchByUrl(o)},openView(o){this.selectedProduct=o,new bootstrap.Modal(document.getElementById("viewProductModal")).show()},async fetchSuppliers(){await this.supplierStore.fetchSupplierWithProducts()},async loadMore(o){this.pageMap[o]||(this.pageMap[o]=1),this.pageMap[o]++,await this.supplierStore.loadMoreSupplierProducts(o,this.pageMap[o])},closeEdit(){bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()},openEdit(o){this.$emit("edit-product",o),bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()}}},st=Object.assign(ot,{setup(o){return(t,s)=>(n(),l(c,null,[(n(!0),l(c,null,g(t.supplierStore.items,a=>{var i;return n(),l("div",{key:a.id,class:"card mb-2"},[e("div",W,[e("h6",L,p(a.name)+" ("+p(a.products_count||0)+"ед.)",1)]),e("div",A,[a.description?(n(),l("p",q,p(a.description),1)):r("",!0),a.address?(n(),l("p",G,p(a.address),1)):r("",!0),e("ul",H,[(n(!0),l(c,null,g(a.products,d=>{var u;return n(),l("li",{key:d.id,class:"list-group-item"},[e("p",{onClick:y(_=>t.openView(d),["prevent"]),class:"small text-primary mb-0"},p(d.name),9,J),(u=d.category)!=null&&u.name?(n(),l("p",K,p(d.category.name||"-"),1)):r("",!0)])}),128))]),((i=a.products)==null?void 0:i.length)<a.products_count?(n(),l("div",Q,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:d=>t.loadMore(a.id)}," Загрузить ещё ",8,R)])):r("",!0)])])}),128)),m(k,{pagination:t.supplierStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.supplierStore.items.length===0?(n(),l("div",X," Товаров пока нет. ")):r("",!0),e("div",Y,[e("div",Z,[e("div",tt,[s[0]||(s[0]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Карточка товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",et,[t.selectedProduct?(n(),b(h,{key:0,product:t.selectedProduct,onClose:t.closeEdit,onEdit:t.openEdit},null,8,["product","onClose","onEdit"])):r("",!0)])])])])],64))}}),nt={class:"card-header"},at={class:"mb-0"},dt={class:"card-body"},lt={key:0,class:"text-muted small"},it={class:"list-group list-group-flush"},rt=["onClick"],ut={key:0,class:"badge bg-success mb-0"},ct={key:1,class:"mt-2 text-center"},pt=["onClick"],mt={key:0,class:"alert alert-info mt-3"},bt={class:"modal fade",id:"viewProductModal",tabindex:"-1"},gt={class:"modal-dialog modal-lg"},ht={class:"modal-content"},yt={class:"modal-body"},ft={name:"Categories",components:{ProductCard:h},data(){return{productCategoryStore:S(),selectedProduct:null,pageMap:{}}},mounted(){this.fetchProductsByCategory()},methods:{async fetchDataByUrl(o){await this.productCategoryStore.fetchByUrl(o)},async fetchProductsByCategory(){await this.productCategoryStore.fetchProductsByCategory()},openView(o){this.selectedProduct=o,new bootstrap.Modal(document.getElementById("viewProductModal")).show()},async loadMore(o){this.pageMap[o]||(this.pageMap[o]=1),this.pageMap[o]++,await this.productCategoryStore.loadMoreProductsInCategory(o,this.pageMap[o])},closeEdit(){bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()},openEdit(o){this.$emit("edit-product",o),bootstrap.Modal.getInstance(document.getElementById("viewProductModal")).hide()}}},vt=Object.assign(ft,{setup(o){return(t,s)=>(n(),l(c,null,[(n(!0),l(c,null,g(t.productCategoryStore.items,a=>{var i;return n(),l("div",{key:a.id,class:"card mb-2"},[e("div",nt,[e("h6",at,p(a.name)+" ("+p(a.products_count||0)+" ед.)",1)]),e("div",dt,[a.description?(n(),l("p",lt,p(a.description),1)):r("",!0),e("ul",it,[(n(!0),l(c,null,g(a.products,d=>{var u;return n(),l("li",{key:d.id,class:"list-group-item"},[e("p",{onClick:y(_=>t.openView(d),["prevent"]),class:"small mb-0"},p(d.name),9,rt),(u=d.supplier)!=null&&u.name?(n(),l("p",ut,p(d.supplier.name),1)):r("",!0)])}),128))]),((i=a.products)==null?void 0:i.length)<a.products_count?(n(),l("div",ct,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:d=>t.loadMore(a.id)}," Загрузить ещё ",8,pt)])):r("",!0)])])}),128)),m(k,{pagination:t.productCategoryStore.pagination,onPageChanged:t.fetchDataByUrl},null,8,["pagination","onPageChanged"]),t.productCategoryStore.items.length===0?(n(),l("div",mt," Товаров пока нет. ")):r("",!0),e("div",bt,[e("div",gt,[e("div",ht,[s[0]||(s[0]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Карточка товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",yt,[t.selectedProduct?(n(),b(h,{key:0,product:t.selectedProduct,onClose:t.closeEdit,onEdit:t.openEdit},null,8,["product","onClose","onEdit"])):r("",!0)])])])])],64))}}),Pt="/bot-api/imports",kt=$("import",{state:()=>({uploading:!1,message:null,error:null}),actions:{async uploadProductWithCategoriesExcel(o){var s,a;this.uploading=!0,this.message=null,this.error=null;const t=M();t.show("Загрузка файла началась");try{const i=new FormData;i.append("excel",o);const{data:d}=await w.post(`${Pt}/import-products-with-categories`,i,{headers:{"Content-Type":"multipart/form-data"}});this.message=d.message||"Файл успешно загружен",t.show(this.message,"success")}catch(i){const d=i;this.error=((a=(s=d.response)==null?void 0:s.data)==null?void 0:a.message)||"Ошибка при загрузке файла",t.show(this.error,"error")}finally{this.uploading=!1}}}}),_t={name:"ImportProducts",data(){return{file:null,jobStore:v(),store:kt()}},methods:{onFileChange(o){this.file=o.target.files[0]},exportProducts(o){this.jobStore.exportProducts(o)},async handleUpload(){this.file&&await this.store.uploadProductWithCategoriesExcel(this.file)}}},Ct={class:"card mb-2"},$t={class:"card-body"},Mt={class:"mb-3"},wt=["disabled"],St={key:0,class:"alert alert-success mb-0"},Et={key:1,class:"alert alert-danger mb-0"},Bt=["disabled"];function xt(o,t,s,a,i,d){return n(),l(c,null,[t[4]||(t[4]=e("p",{class:"alert alert-info"}," При импорте товаров будут созданы также категории и поставщики, которых еще нет в системе. ",-1)),e("div",Ct,[t[3]||(t[3]=e("div",{class:"card-header bg-primary text-white"},[e("h6",{class:"mb-0"},"Импорт Excel-файла с продуктами")],-1)),e("div",$t,[e("form",{onSubmit:t[1]||(t[1]=y((...u)=>d.handleUpload&&d.handleUpload(...u),["prevent"]))},[e("div",Mt,[e("input",{type:"file",class:"form-control",onChange:t[0]||(t[0]=(...u)=>d.onFileChange&&d.onFileChange(...u)),accept:".xlsx,.xls"},null,32)]),e("button",{class:"btn btn-success w-100 p-3 mb-2",type:"submit",disabled:i.store.uploading||!i.file},p(i.store.uploading?"Загрузка...":"Загрузить"),9,wt)],32),i.store.message?(n(),l("div",St,p(i.store.message),1)):r("",!0),i.store.error?(n(),l("div",Et,p(i.store.error),1)):r("",!0)])]),e("button",{type:"button",disabled:i.jobStore.loading,class:"btn btn-outline-light text-primary w-100 p-3",onClick:t[2]||(t[2]=u=>d.exportProducts(0))}," Скачать пример ",8,Bt)],64)}const It=P(_t,[["render",xt]]),jt={class:"container-fluid p-3"},Dt={key:1,class:"alert alert-info"},Ut={class:"navbar fixed-bottom p-3"},Ft={class:"modal fade",id:"createProductModal",tabindex:"-1"},Vt={class:"modal-dialog modal-lg"},zt={class:"modal-content"},Tt={class:"modal-body"},Nt={class:"modal fade",id:"createCategoryModal",tabindex:"-1"},Ot={class:"modal-dialog"},Wt={class:"modal-content"},Lt={class:"modal-body"},At={data(){return{loading:!1,selectedProduct:null,tab:"menu"}},mounted(){},methods:{openProductModal(){this.loading=!0,this.$nextTick(()=>{this.loading=!1,new bootstrap.Modal(document.getElementById("createProductModal")).show()})},selectMenu(o){this.tab=o},openEditProduct(o){this.selectMenu("product"),this.selectedProduct=o},fetchProducts(){const o=bootstrap.Modal.getInstance(document.getElementById("createProductModal"));o&&o.hide(),this.loading=!0,this.$nextTick(()=>{this.loading=!1})},fetchData(){const o=bootstrap.Modal.getInstance(document.getElementById("createCategoryModal"));o&&o.hide(),this.loading=!0,this.$nextTick(()=>{this.loading=!1})}}},te=Object.assign(At,{__name:"ProductPage",setup(o){return(t,s)=>(n(),l(c,null,[e("div",jt,[t.tab==="menu"?(n(),l(c,{key:0},[m(I),m(O,{onSelect:t.selectMenu},null,8,["onSelect"])],64)):r("",!0),t.tab==="product"?(n(),l(c,{key:1},[e("button",{onClick:s[0]||(s[0]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),t.selectedProduct?(n(),b(f,{key:0,"initial-data":t.selectedProduct},null,8,["initial-data"])):(n(),l("p",Dt," Продукт не выбран "))],64)):r("",!0),t.tab==="products"?(n(),l(c,{key:2},[e("button",{onClick:s[1]||(s[1]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[7]||(s[7]=e("h4",{class:"mb-3"},"Список товаров",-1)),t.loading?r("",!0):(n(),b(C,{key:0})),e("nav",Ut,[e("button",{type:"button",onClick:s[2]||(s[2]=(...a)=>t.openProductModal&&t.openProductModal(...a)),class:"btn w-100 p-3 btn-primary"}," Добавить товар ")])],64)):r("",!0),t.tab==="products-by-supplier"?(n(),l(c,{key:3},[e("button",{onClick:s[3]||(s[3]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[8]||(s[8]=e("h4",{class:"mb-3"},"Список товаров по поставщику",-1)),m(st,{onEditProduct:t.openEditProduct},null,8,["onEditProduct"])],64)):r("",!0),t.tab==="products-by-categories"?(n(),l(c,{key:4},[e("button",{onClick:s[4]||(s[4]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[9]||(s[9]=e("h4",{class:"mb-3"},"Список товаров по категориям",-1)),m(vt,{onEditProduct:t.openEditProduct},null,8,["onEditProduct"])],64)):r("",!0),t.tab==="categories"?(n(),l(c,{key:5},[e("button",{onClick:s[5]||(s[5]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),s[10]||(s[10]=e("h4",{class:"mb-3"},"Категории товара",-1)),m(E),s[11]||(s[11]=e("nav",{class:"navbar fixed-bottom p-3"},[e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#createCategoryModal",class:"btn w-100 p-3 btn-primary"}," Добавить категорию ")],-1))],64)):r("",!0),t.tab==="import-products"?(n(),l(c,{key:6},[e("button",{onClick:s[6]||(s[6]=a=>t.tab="menu"),class:"btn btn-light text-secondary mb-3",style:{position:"sticky",top:"80px","z-index":"100"}},"Назад"),m(It)],64)):r("",!0)]),e("div",Ft,[e("div",Vt,[e("div",zt,[s[12]||(s[12]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Добавление товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",Tt,[t.loading?r("",!0):(n(),b(f,{key:0,onSaved:t.fetchProducts},null,8,["onSaved"]))])])])]),e("div",Nt,[e("div",Ot,[e("div",Wt,[s[13]||(s[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Создание новой категории товара"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),e("div",Lt,[m(B,{onSaved:t.fetchData},null,8,["onSaved"])])])])])],64))}});export{te as default};
