import{c as n,o as i,a as t,f as r,d as a,t as d,w as b,F as y,e as u,g as E,j as f,v as w,G as L,r as N,h as _,n as F,b as $}from"./app-BFXy5JVw.js";import{a as G,u as I,_ as H}from"./SaleForm-BxlCR_78.js";import{P as J}from"./Pagination-BEOn-jB3.js";import{_ as K,u as Q}from"./AgentList--d11xEmx.js";import{_ as R}from"./SupplierList-DrYW336K.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as W}from"./users-DgYKCs5C.js";import{u as X}from"./useConfitmModalStore-3K6mUG_C.js";const Y={class:"mb-2"},Z={class:"dropdown d-inline-block ms-2"},x={style:{"font-size":"12px"},class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown"},ee={key:0},te={key:1},se={key:2},le={class:"dropdown-menu"},oe={class:"modal fade",id:"saleFilterModal",tabindex:"-1"},ie={class:"modal-dialog modal-fullscreen"},ne={class:"modal-body"},ae={class:"form-check form-switch mb-2"},de={class:"form-floating mb-2"},re={class:"form-floating mb-2"},ue={class:"form-floating mb-2"},me={class:"form-floating mb-2"},pe={class:"form-floating mb-2"},fe={class:"form-floating mb-2"},be={class:"form-floating mb-2"},ye={class:"form-floating mb-2"},ge={key:0,class:"mb-0",style:{"font-size":"10px"}},ve={class:"input-group mb-2"},ce={class:"form-floating flex-grow-1"},ke={key:1,class:"mb-0",style:{"font-size":"10px"}},Se={class:"input-group mb-2"},he={class:"form-floating flex-grow-1"},we={key:2,class:"mb-0",style:{"font-size":"10px"}},Ce={class:"input-group mb-2"},_e={class:"form-floating flex-grow-1"},$e=["onUpdate:modelValue","id"],Fe=["for"],Ie={class:"form-floating mb-2"},De={class:"form-floating mb-3"},Me={name:"SaleFilterForm",data(){return{page:1,size:20,onlyMyTask:!1,salesStore:I(),tab:"filter",titleMap:{agent:"Выбор младшего админа",customer:"Выбор клиента",supplier:"Выбор поставщика"},selectedAgent:null,selectedSupplier:null,selectedCustomer:null,field_visible:[],sortableFields:{id:"№",title:"Название",description:"Описание",status:"Статус",due_date:"Дата назначения встречи",sale_date:"Дата продажи",payment_type:"Тип оплаты",actual_delivery_date:"Фактическая дата доставки",quantity:"Доставляемое число товара",total_price:"Сумма заказа",agent_id:"Торговый представитель",customer_id:"Клиент",supplier_id:"Поставщик",created_by_id:"Создатель заявки",product_id:"Продукт"},filters:{number:"",title:"",payment_type:null,description:"",status:"",date_type:null,date_from:"",date_to:"",agent_id:"",customer_id:"",supplier_id:"",created_by_id:"",quantity:"",total_price:""}}},mounted(){let o=["title","description","status","due_date"];for(const s in this.sortableFields)this.field_visible[s]=o.indexOf(s)!==-1;this.tab="filter"},methods:{applyFilters(){const o={...this.filters,size:this.size,page:this.page,only_my_tasks:this.onlyMyTask,field_visible:this.field_visible},s=bootstrap.Modal.getInstance(document.getElementById("saleFilterModal"));s&&s.hide(),this.$emit("apply-filters",o)},selectAgent(o){this.selectedAgent=null,this.$nextTick(()=>{this.selectedAgent=o,this.filters.agent_id=(o==null?void 0:o.id)||null,this.tab="filter"})},openFilter(){new bootstrap.Modal(document.getElementById("saleFilterModal")).show()},selectCustomer(o){this.selectedCustomer=null,this.$nextTick(()=>{this.selectedCustomer=o,this.filters.customer_id=(o==null?void 0:o.id)||null,this.tab="filter"})},selectSupplier(o){this.selectedSupplier=null,this.$nextTick(()=>{this.selectedSupplier=o,this.filters.supplier_id=(o==null?void 0:o.id)||null,this.tab="filter"})},changeSort(o){const s=this.salesStore.sort,e=s.field===o&&s.direction==="asc"?"desc":"asc";this.salesStore.setSort(o,e),this.salesStore.fetchFiltered()},clearFilters(){const o={number:"",title:"",description:"",status:"",date_type:null,date_from:"",date_to:"",agent_id:"",customer_id:"",supplier_id:"",created_by_id:"",quantity:"",total_price:""};this.size=20,this.page=1,this.onlyMyTask=!1;let s=["title","description","status","due_date"];for(const e in this.sortableFields)this.field_visible[e]=s.indexOf(e)!==-1;this.filters=o}}},Te=Object.assign(Me,{setup(o){return(s,e)=>(i(),n(y,null,[t("div",Y,[t("button",{style:{"font-size":"12px"},class:"btn btn-secondary",onClick:e[0]||(e[0]=(...l)=>s.openFilter&&s.openFilter(...l))},"Фильтр"),t("div",Z,[t("button",x,[r(d(s.sortableFields[s.salesStore.sort.field].slice(0,17))+" ",1),s.sortableFields[s.salesStore.sort.field].length>17?(i(),n("span",ee,"...")):a("",!0),e[35]||(e[35]=r(" (",-1)),s.salesStore.sort.direction==="asc"?(i(),n("span",te,[...e[33]||(e[33]=[t("i",{class:"fa-solid fa-arrow-down"},null,-1)])])):a("",!0),s.salesStore.sort.direction==="desc"?(i(),n("span",se,[...e[34]||(e[34]=[t("i",{class:"fa-solid fa-arrow-up"},null,-1)])])):a("",!0),e[36]||(e[36]=r(") ",-1))]),t("ul",le,[t("li",null,[t("a",{class:"dropdown-item",onClick:e[1]||(e[1]=l=>s.changeSort("title"))},"Название")]),t("li",null,[t("a",{class:"dropdown-item",onClick:e[2]||(e[2]=l=>s.changeSort("status"))},"Статус")]),t("li",null,[t("a",{class:"dropdown-item",onClick:e[3]||(e[3]=l=>s.changeSort("sale_date"))},"Дата продажи")]),t("li",null,[t("a",{class:"dropdown-item",onClick:e[4]||(e[4]=l=>s.changeSort("total_price"))},"Сумма")])])])]),t("div",oe,[t("div",ie,[t("form",{onSubmit:e[32]||(e[32]=b((...l)=>s.applyFilters&&s.applyFilters(...l),["prevent"])),class:"modal-content"},[e[56]||(e[56]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Фильтры"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ne,[s.tab==="filter"?(i(),n(y,{key:0},[t("div",ae,[u(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>s.onlyMyTask=l),id:"only-my-tasks"},null,512),[[E,s.onlyMyTask]]),e[37]||(e[37]=t("label",{class:"form-check-label",for:"only-my-tasks"}," Только мои сделки ",-1))]),t("div",de,[u(t("input",{class:"form-control","onUpdate:modelValue":e[6]||(e[6]=l=>s.filters.number=l),id:"titleInput",placeholder:"Номер сделки"},null,512),[[f,s.filters.number]]),e[38]||(e[38]=t("label",{for:"titleInput"},"Номер сделки",-1))]),t("div",re,[u(t("input",{class:"form-control","onUpdate:modelValue":e[7]||(e[7]=l=>s.filters.title=l),id:"titleInput",placeholder:"Название"},null,512),[[f,s.filters.title]]),e[39]||(e[39]=t("label",{for:"titleInput"},"Название",-1))]),t("div",ue,[u(t("input",{class:"form-control","onUpdate:modelValue":e[8]||(e[8]=l=>s.filters.description=l),id:"descInput",placeholder:"Описание"},null,512),[[f,s.filters.description]]),e[40]||(e[40]=t("label",{for:"descInput"},"Описание",-1))]),t("div",me,[u(t("select",{id:"itemsPerPage",class:"form-select","onUpdate:modelValue":e[9]||(e[9]=l=>s.filters.payment_type=l)},[...e[41]||(e[41]=[t("option",{value:null},"Любой тип оплаты",-1),t("option",{value:"0"},"Наличная оплата",-1),t("option",{value:"1"},"Безналичная оплата",-1)])],512),[[w,s.filters.payment_type]]),e[42]||(e[42]=t("label",{for:"itemsPerPage"},"Тип оплаты",-1))]),t("div",pe,[u(t("select",{"onUpdate:modelValue":e[10]||(e[10]=l=>s.filters.status=l),class:"form-select",id:"statusSelect"},[...e[43]||(e[43]=[L('<option value="">Все</option><option value="pending">В ожидании</option><option value="assigned">Назначено</option><option value="completed">Завершено</option><option value="delivered">Доставляется</option><option value="rejected">Отклонено</option>',6)])],512),[[w,s.filters.status]]),e[44]||(e[44]=t("label",{for:"statusSelect"},"Статус",-1))]),t("div",fe,[u(t("select",{"onUpdate:modelValue":e[11]||(e[11]=l=>s.filters.date_type=l),class:"form-select",id:"dateTypeSelect"},[...e[45]||(e[45]=[t("option",{value:null},"Не имеет значения",-1),L('<option value="0">Дата создания задачи</option><option value="1">Дата исполнения задания</option><option value="2">Дата заключения сделки (продажи)</option><option value="3">Дата доставки по договору</option><option value="4">Дата доставки фактическая</option>',5)])],512),[[w,s.filters.date_type]]),e[46]||(e[46]=t("label",{for:"dateTypeSelect"},"Тип даты",-1))]),t("div",be,[u(t("input",{type:"date","onUpdate:modelValue":e[12]||(e[12]=l=>s.filters.date_from=l),class:"form-control",id:"dateFromInput"},null,512),[[f,s.filters.date_from]]),e[47]||(e[47]=t("label",{for:"dateFromInput"},"Дата от",-1))]),t("div",ye,[u(t("input",{type:"date","onUpdate:modelValue":e[13]||(e[13]=l=>s.filters.date_to=l),class:"form-control",id:"dateToInput"},null,512),[[f,s.filters.date_to]]),e[48]||(e[48]=t("label",{for:"dateToInput"},"Дата до",-1))]),s.selectedAgent?(i(),n("p",ge,"Выбран торговый представитель: "+d(s.selectedAgent.name||"не указан"),1)):a("",!0),t("div",ve,[t("div",ce,[u(t("input",{onChange:e[14]||(e[14]=l=>s.selectedAgent=null),"onUpdate:modelValue":e[15]||(e[15]=l=>s.filters.agent_id=l),class:"form-control",id:"agentInput",placeholder:"Агент"},null,544),[[f,s.filters.agent_id]]),e[49]||(e[49]=t("label",{for:"agentInput"},"Младший админ",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:e[16]||(e[16]=l=>s.tab="agent")}," Выбрать ")]),s.selectedCustomer?(i(),n("p",ke,"Выбран клиент: "+d(s.selectedCustomer.name||"не указан"),1)):a("",!0),t("div",Se,[t("div",he,[u(t("input",{class:"form-control",onChange:e[17]||(e[17]=l=>s.selectedCustomer=null),"onUpdate:modelValue":e[18]||(e[18]=l=>s.filters.customer_id=l),id:"customerInput",placeholder:"Клиент"},null,544),[[f,s.filters.customer_id]]),e[50]||(e[50]=t("label",{for:"customerInput"},"Клиент",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:e[19]||(e[19]=l=>s.tab="customer")}," Выбрать ")]),s.selectedSupplier?(i(),n("p",we,"Выбран поставщик: "+d(s.selectedSupplier.name||"не указан"),1)):a("",!0),t("div",Ce,[t("div",_e,[u(t("input",{class:"form-control",onChange:e[20]||(e[20]=l=>s.selectedSupplier=null),"onUpdate:modelValue":e[21]||(e[21]=l=>s.filters.supplier_id=l),id:"supplierInput",placeholder:"Поставщик"},null,544),[[f,s.filters.supplier_id]]),e[51]||(e[51]=t("label",{for:"supplierInput"},"Поставщик",-1))]),t("button",{type:"button",class:"btn btn-outline-light text-primary",onClick:e[22]||(e[22]=l=>s.tab="supplier")}," Выбрать ")]),e[55]||(e[55]=t("h6",null,"Отображаемые поля",-1)),(i(!0),n(y,null,N(s.sortableFields,(l,m)=>(i(),n("div",{key:m,class:"form-check form-switch mb-2"},[u(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":p=>s.field_visible[m]=p,id:`switch-${m}`},null,8,$e),[[E,s.field_visible[m]]]),t("label",{class:"form-check-label",for:`switch-${m}`},d(l),9,Fe)]))),128)),t("div",Ie,[u(t("select",{id:"itemsPerPage",class:"form-select","onUpdate:modelValue":e[23]||(e[23]=l=>s.size=l)},[...e[52]||(e[52]=[t("option",{value:"10"},"10",-1),t("option",{value:"20"},"20",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)])],512),[[w,s.size]]),e[53]||(e[53]=t("label",{for:"itemsPerPage"},"Элементов на странице",-1))]),t("div",De,[u(t("input",{type:"number",id:"pageNumber",class:"form-control","onUpdate:modelValue":e[24]||(e[24]=l=>s.page=l),min:"1"},null,512),[[f,s.page]]),e[54]||(e[54]=t("label",{for:"pageNumber"},"Номер страницы",-1))]),t("button",{type:"button",onClick:e[25]||(e[25]=(...l)=>s.clearFilters&&s.clearFilters(...l)),class:"btn btn-outline-light text-secondary mb-2 w-100 p-3"},"Очистить фильтры ")],64)):a("",!0),s.tab==="agent"?(i(),n(y,{key:1},[t("button",{class:"btn btn-secondary my-3",onClick:e[26]||(e[26]=l=>s.tab="filter")},"Назад "),s.selectedAgent!=null?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:e[27]||(e[27]=l=>s.selectAgent(null))},"Отменить выбор ")):a("",!0),_(K,{"for-select":!0,onSelectAgent:s.selectAgent},null,8,["onSelectAgent"])],64)):a("",!0),s.tab==="customer"?(i(),n(y,{key:2},[t("button",{class:"btn btn-secondary my-3",onClick:e[28]||(e[28]=l=>s.tab="filter")},"Назад "),s.selectedCustomer!=null?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:e[29]||(e[29]=l=>s.selectCustomer(null))},"Отменить выбор ")):a("",!0),_(G,{"for-select":!0,onSelectCustomer:s.selectCustomer},null,8,["onSelectCustomer"])],64)):a("",!0),s.tab==="supplier"?(i(),n(y,{key:3},[t("button",{class:"btn btn-secondary my-3",onClick:e[30]||(e[30]=l=>s.tab="filter")},"Назад "),s.selectedSupplier!=null?(i(),n("button",{key:0,type:"button",class:"btn btn-outline-secondary p-3 w-100 mb-2",onClick:e[31]||(e[31]=l=>s.selectSupplier(null))},"Отменить выбор ")):a("",!0),_(R,{"for-select":!0,onSelectSupplier:s.selectSupplier},null,8,["onSelectSupplier"])],64)):a("",!0)]),e[57]||(e[57]=t("div",{class:"modal-footer"},[t("button",{type:"submit",class:"btn btn-primary w-100 p-3"},"Применить фильтры")],-1))],32)])])],64))}}),Ve={name:"TaskCard",props:{task:{type:Object,required:!0}},data(){return{salesStore:I(),statusLabels:{pending:"В ожидании",assigned:"Назначено",delivered:"Доставлено",completed:"Завершено",rejected:"Отклонено"}}},methods:{formatDate(o){return o?new Date(o).toLocaleDateString():"—"},async sendPaymentDocumentToTg(){await this.salesStore.sendPaymentDocumentToTg(this.task.id)},statusClass(o){switch(o){case"pending":return"bg-secondary";case"assigned":return"bg-info";case"delivered":return"bg-primary";case"completed":return"bg-success";case"rejected":return"bg-danger";default:return"bg-dark"}}}},Pe={class:"mb-2"},Ue={class:"mb-2"},Be={class:"text-muted"},je={class:"list-group list-group-flush"},qe={class:"list-group-item"},ze={class:"list-group-item"},Ae={class:"list-group-item"},Ee={class:"list-group-item"},Le={key:0},Ne={key:1},Oe={class:"list-group-item"},Ge={class:"list-group-item"},He={class:"mt-3"},Je={class:"text-muted small"};function Ke(o,s,e,l,m,p){var v,c,k,S,h;return i(),n(y,null,[t("h6",Pe,[r(d(e.task.title)+" ",1),t("span",{class:F(["badge",p.statusClass(e.task.status)])},d(m.statusLabels[e.task.status]),3)]),t("div",Ue,[t("p",Be,d(e.task.description),1),t("ul",je,[t("li",qe,[s[1]||(s[1]=t("strong",null,"Дата встречи:",-1)),r(" "+d(p.formatDate(e.task.due_date)),1)]),t("li",ze,[s[2]||(s[2]=t("strong",null,"Дата продажи:",-1)),r(" "+d(p.formatDate(e.task.sale_date)),1)]),t("li",Ae,[s[3]||(s[3]=t("strong",null,"Фактическая доставка:",-1)),r(" "+d(p.formatDate(e.task.actual_delivery_date)),1)]),t("li",Ee,[s[4]||(s[4]=t("strong",null,"Тип оплаты:",-1)),e.task.payment_type===0?(i(),n("span",Le,"Наличный расчет")):a("",!0),e.task.payment_type===1?(i(),n("span",Ne,"Безналичный расчет")):a("",!0)]),t("li",Oe,[s[5]||(s[5]=t("strong",null,"Количество:",-1)),r(" "+d(e.task.quantity),1)]),t("li",Ge,[s[6]||(s[6]=t("strong",null,"Сумма заказа:",-1)),r(" "+d(e.task.total_price)+" ₴ ",1)])]),t("div",He,[s[12]||(s[12]=t("h6",{class:"fw-bold text-primary"},"Связанные элементы",-1)),t("p",null,[s[7]||(s[7]=t("strong",null,"Младший админ:",-1)),r(" "+d(((v=e.task.agent)==null?void 0:v.name)||"—"),1)]),t("p",null,[s[8]||(s[8]=t("strong",null,"Покупатель:",-1)),r(" "+d(((c=e.task.customer)==null?void 0:c.name)||"—"),1)]),t("p",null,[s[9]||(s[9]=t("strong",null,"Поставщик:",-1)),r(" "+d(((k=e.task.supplier)==null?void 0:k.name)||"—"),1)]),t("p",null,[s[10]||(s[10]=t("strong",null,"Продукт:",-1)),r(" "+d(((S=e.task.product)==null?void 0:S.name)||"—"),1)]),t("p",null,[s[11]||(s[11]=t("strong",null,"Создан администратором:",-1)),r(" "+d(((h=e.task.created_by)==null?void 0:h.name)||"—"),1)])]),e.task.payment_document_name?(i(),n("button",{key:0,onClick:s[0]||(s[0]=(...C)=>p.sendPaymentDocumentToTg&&p.sendPaymentDocumentToTg(...C)),class:"btn btn-info p-3 w-100",type:"button"},"Документ чека ")):a("",!0)]),t("div",Je," Создано: "+d(p.formatDate(e.task.created_at))+" | Обновлено: "+d(p.formatDate(e.task.updated_at)),1)],64)}const Qe=O(Ve,[["render",Ke]]),Re={class:"list-group"},We={class:"fw-bold mb-2"},Xe={key:0,class:"fa-solid fa-clock",style:{"margin-left":"8px"}},Ye={key:1,class:"badge bg-success"},Ze={key:2,class:"badge bg-primary"},xe={key:0,class:"fw-bold mb-2",style:{"font-size":"14px"}},et={key:1,class:"fw-bold mb-2",style:{"font-size":"14px"}},tt={key:2,class:"fw-bold mb-2",style:{"font-size":"14px"}},st={key:0},lt={key:1},ot={key:3,class:"fw-bold mb-2",style:{"font-size":"14px"}},it={key:4,class:"text-muted"},nt={key:5,class:"mb-2"},at={key:6,class:"mb-2"},dt={class:"fw-bold"},rt={key:7,class:"mb-2"},ut={class:"fw-bold"},mt={key:8,class:"mb-2"},pt={class:"fw-bold"},ft={key:9,class:"mb-2"},bt={class:"fw-bold"},yt={key:10,class:"mb-2"},gt={class:"fw-bold"},vt={key:11,class:"mb-2"},ct={class:"fw-bold"},kt={key:12,class:"mb-2"},St={class:"fw-bold"},ht={class:"dropdown"},wt={class:"dropdown-menu dropdown-menu-end"},Ct={key:0},_t=["onClick"],$t=["onClick"],Ft=["onClick"],It={key:0},Dt=["onClick"],Mt={key:1},Tt=["onClick"],Vt=["onClick"],Pt=["onClick"],Ut=["onClick"],Bt={key:1,class:"alert alert-info mt-3"},jt={class:"modal fade",id:"editSaleModal",tabindex:"-1"},qt={class:"modal-dialog modal-fullscreen"},zt={class:"modal-content"},At={class:"modal-body"},Et={class:"modal fade",id:"viewSaleModal",tabindex:"-1"},Lt={class:"modal-dialog modal-lg"},Nt={class:"modal-content"},Ot={class:"modal-body"},Gt={class:"modal fade",id:"confirmDealModal",tabindex:"-1"},Ht={class:"modal-dialog"},Jt={class:"modal-content"},Kt={class:"modal-body"},Qt={class:"form-floating mb-2"},Rt={class:"form-floating mb-2"},Wt={class:"form-floating mb-2"},Xt={class:"modal fade",id:"paymentConfirmForm",tabindex:"-1"},Yt={class:"modal-dialog"},Zt={class:"modal-content"},xt={class:"modal-body"},es={class:"form-floating mb-2"},ts={key:0,class:"card mb-2 rounded-0"},ss={class:"card-body"},ls={class:"form-floating"},os={name:"SaleList",props:["forSelect","adminId","agentId","productId","customerId","supplierId"],data(){return{field_visible:null,sales:[],search:"",userStore:W(),salesStore:I(),agentStore:Q(),modalStore:X(),selectedSale:null,saleStatuses:{pending:"В ожидании",assigned:"Назначено",completed:"Завершено",rejected:"Отклонено",delivered:"Доставляется"},paymentConfirmForm:{file:null,payment_type:0},dealForm:{sale_date:new Date().toISOString().split("T")[0],quantity:0,total_price:0}}},computed:{user(){return this.userStore.self||null},filteredSales(){return this.salesStore.items.filter(o=>o.title.toLowerCase().includes(this.search.toLowerCase()))}},created(){var o;this.salesStore.setFilters({created_by_id:this.adminId||null,customer_id:this.customerId||null,product_id:this.productId||null,supplier_id:this.supplierId||null}),(((o=this.user)==null?void 0:o.role)||0)>=3?this.salesStore.fetchFiltered():this.salesStore.selfSalesFiltered()},methods:{async sendPaymentDocumentToTg(o){await this.salesStore.sendPaymentDocumentToTg(o)},onFileChange(o){this.paymentConfirmForm.file=o.target.files[0]},async fetchData(o=1){await this.salesStore.fetchAllByPage(o);const s=bootstrap.Modal.getInstance(document.getElementById("editSaleModal"));s&&s.hide();const e=bootstrap.Modal.getInstance(document.getElementById("confirmDealModal"));e&&e.hide()},async fetchDataByUrl(o){await this.salesStore.fetchByUrl(o)},openEdit(o){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=o,new bootstrap.Modal(document.getElementById("editSaleModal")).show()})},confirmDelete(o){var s;this.selectedSale=o,this.modalStore.open(`Вы уверены, что хотите удалить ${(s=this.selectedSale)==null?void 0:s.title}?`,()=>this.salesStore.deleteSale(this.selectedSale.id),()=>this.modalStore.close())},async deleteSale(){try{await this.salesStore.deleteSale(),bootstrap.Modal.getInstance(document.getElementById("deleteSaleModal")).hide()}catch(o){console.error("Ошибка удаления продажи:",o)}},openView(o){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=o,new bootstrap.Modal(document.getElementById("viewSaleModal")).show()})},openConfirmPayment(o){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=o,this.paymentConfirmForm.payment_type=o.payment_type,new bootstrap.Modal(document.getElementById("paymentConfirmForm")).show()})},openConfirmDeal(o){this.selectedSale=null,this.$nextTick(()=>{this.selectedSale=o,this.dealForm.quantity=o.quantity,this.dealForm.id=o.id,this.dealForm.total_price=o.total_price,new bootstrap.Modal(document.getElementById("confirmDealModal")).show()})},async confirmPayment(){this.paymentConfirmForm.id=this.selectedSale.id,await this.salesStore.confirmPayment(this.paymentConfirmForm),bootstrap.Modal.getInstance(document.getElementById("paymentConfirmForm")).hide()},async confirmDeal(){this.dealForm.id=this.selectedSale.id,await this.salesStore.confirmDeal(this.dealForm),bootstrap.Modal.getInstance(document.getElementById("confirmDealModal")).hide()},async cancelDeal(o){try{await this.salesStore.cancelDeal(o)}catch(s){console.error("Ошибка отмены сделки:",s)}},applyFilters(o){var m;this.field_visible=o.field_visible;let s=o.size||30,e=o.page||1;const l=o.only_my_tasks||(((m=this.user)==null?void 0:m.role)||0)<3;delete o.field_visible,delete o.only_my_tasks,this.salesStore.setFilters(o),l?this.salesStore.selfSalesFiltered(e,s):this.salesStore.fetchFiltered(e,s)}}},is=Object.assign(os,{setup(o){return(s,e)=>(i(),n(y,null,[u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.search=l),type:"text",class:"form-control mb-2",placeholder:"Поиск по названию..."},null,512),[[f,s.search]]),_(Te,{onApplyFilters:s.applyFilters},null,8,["onApplyFilters"]),t("ul",Re,[(i(!0),n(y,null,N(s.filteredSales,l=>{var m,p,v,c,k,S,h,C,D,M,T,V,P,U,B,j,q,z,A;return i(),n("li",{key:l.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",null,[t("p",We,[l.payment_type===0?(i(),n("span",{key:0,class:F(["badge",{"bg-warning":!l.sale_date,"bg-success":l.sale_date}])},[e[8]||(e[8]=t("i",{class:"fa-solid fa-money-bill"},null,-1)),l.sale_date?a("",!0):(i(),n("i",Xe))],2)):a("",!0),l.payment_type===1?(i(),n("span",Ye,[...e[9]||(e[9]=[t("i",{class:"fa-solid fa-credit-card"},null,-1)])])):a("",!0),(m=s.field_visible)!=null&&m.id?(i(),n("span",Ze,"#"+d(l.id),1)):a("",!0),r(" "+d(l.title),1)]),((p=s.field_visible)!=null&&p.due_date,i(),n("p",xe,"Дата задания "+d(l.due_date||"не указана"),1)),(v=s.field_visible)!=null&&v.sale_date?(i(),n("p",et,"Дата продажи "+d(l.sale_date||"не указана"),1)):a("",!0),(c=s.field_visible)!=null&&c.payment_type?(i(),n("p",tt,[e[10]||(e[10]=r(" Тип оплаты ",-1)),l.payment_type===0?(i(),n("span",st,"Наличный расчет")):a("",!0),l.payment_type===1?(i(),n("span",lt,"Безналичный расчет")):a("",!0)])):a("",!0),(k=s.field_visible)!=null&&k.actual_delivery_date?(i(),n("p",ot," Фактическая дата доставки "+d(l.actual_delivery_date||"не указана"),1)):a("",!0),(S=s.field_visible)!=null&&S.status?(i(),n("small",it,[e[11]||(e[11]=r("Статус: ",-1)),t("span",{class:F(["badge",{"bg-warning":l.status==="pending","bg-info":l.status==="assigned","bg-primary":l.status==="delivered","bg-success":l.status==="completed","bg-danger":l.status==="rejected"}])},d(s.saleStatuses[l.status]),3)])):a("",!0),(h=s.field_visible)!=null&&h.description?(i(),n("p",nt,d(l.description),1)):a("",!0),(C=s.field_visible)!=null&&C.quantity?(i(),n("p",at,[e[12]||(e[12]=r("Доставляемое число товара ",-1)),t("span",dt,d(l.quantity||"не указана"),1),e[13]||(e[13]=r(" ед.",-1))])):a("",!0),(D=s.field_visible)!=null&&D.total_price?(i(),n("p",rt,[e[14]||(e[14]=r("Сумма заказа ",-1)),t("span",ut,d(l.total_price),1),e[15]||(e[15]=r(" руб.",-1))])):a("",!0),(M=s.field_visible)!=null&&M.agent_id?(i(),n("p",mt,[e[16]||(e[16]=r("Младший админ ",-1)),t("span",pt,d(((T=l.agent)==null?void 0:T.name)||l.agent_id||"-"),1)])):a("",!0),(V=s.field_visible)!=null&&V.customer_id?(i(),n("p",ft,[e[17]||(e[17]=r("Клиент ",-1)),t("span",bt,d(((P=l.customer)==null?void 0:P.name)||l.customer_id||"-"),1)])):a("",!0),(U=s.field_visible)!=null&&U.supplier_id?(i(),n("p",yt,[e[18]||(e[18]=r("Поставщик ",-1)),t("span",gt,d(((B=l.supplier)==null?void 0:B.name)||l.supplier_id||"-"),1)])):a("",!0),(j=s.field_visible)!=null&&j.created_by_id?(i(),n("p",vt,[e[19]||(e[19]=r("Администратор ",-1)),t("span",ct,d(((q=l.creator)==null?void 0:q.name)||l.created_by_id||"-"),1)])):a("",!0),(z=s.field_visible)!=null&&z.product_id?(i(),n("p",kt,[e[20]||(e[20]=r("Товар ",-1)),t("span",St,d(((A=l.product)==null?void 0:A.name)||l.product_id||"-"),1)])):a("",!0)]),t("div",ht,[e[23]||(e[23]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",wt,[o.forSelect?(i(),n("li",Ct,[t("a",{class:"dropdown-item",href:"#",onClick:b(g=>s.$emit("select",l),["prevent"])},"Выбрать",8,_t)])):a("",!0),o.forSelect?a("",!0):(i(),n(y,{key:1},[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:b(g=>s.openView(l),["prevent"])},"Просмотреть",8,$t)]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:b(g=>s.openEdit(l),["prevent"])},"Редактировать",8,Ft)]),l.status!=="completed"?(i(),n("li",It,[t("a",{class:"dropdown-item text-success",href:"javascript:void(0)",onClick:b(g=>s.openConfirmDeal(l),["prevent"])},"Подтвердить доставку",8,Dt)])):a("",!0),l.payment_type===0&&!l.sale_date?(i(),n("li",Mt,[t("a",{class:"dropdown-item text-success",href:"javascript:void(0)",onClick:b(g=>s.openConfirmPayment(l),["prevent"])},"Подтвердить оплату",8,Tt)])):a("",!0),l.payment_document_name?(i(),n(y,{key:2},[e[21]||(e[21]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-success",href:"javascript:void(0)",onClick:b(g=>s.sendPaymentDocumentToTg(l.id),["prevent"])},"Отправить документ в чат",8,Vt)])],64)):a("",!0),e[22]||(e[22]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:b(g=>s.confirmDelete(l),["prevent"])},"Удалить",8,Pt)]),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:b(g=>s.cancelDeal(l),["prevent"])},"Отменить сделку",8,Ut)])],64))])])])}),128))]),s.salesStore.items.length>0?(i(),$(J,{key:0,pagination:s.salesStore.pagination,onPageChanged:s.fetchDataByUrl},null,8,["pagination","onPageChanged"])):a("",!0),s.salesStore.items.length===0?(i(),n("div",Bt," На текущий момент у вас нет продаж. ")):a("",!0),t("div",jt,[t("div",qt,[t("div",zt,[e[24]||(e[24]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование задания"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",At,[s.selectedSale?(i(),$(H,{key:0,initialData:s.selectedSale,onSaved:s.fetchData},null,8,["initialData","onSaved"])):a("",!0)])])])]),t("div",Et,[t("div",Lt,[t("div",Nt,[e[25]||(e[25]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Карточка задания"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Ot,[s.selectedSale?(i(),$(Qe,{key:0,task:s.selectedSale},null,8,["task"])):a("",!0)])])])]),t("div",Gt,[t("div",Ht,[t("div",Jt,[e[30]||(e[30]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Подтверждение сделки"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",Kt,[t("form",{onSubmit:e[4]||(e[4]=b((...l)=>s.confirmDeal&&s.confirmDeal(...l),["prevent"]))},[t("div",Qt,[u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.dealForm.sale_date=l),type:"date",class:"form-control",id:"sale_date",required:""},null,512),[[f,s.dealForm.sale_date]]),e[26]||(e[26]=t("label",{for:"sale_date"},"Дата",-1))]),t("div",Rt,[u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.dealForm.quantity=l),type:"number",class:"form-control",id:"quantity",placeholder:"Количество",required:""},null,512),[[f,s.dealForm.quantity]]),e[27]||(e[27]=t("label",{for:"quantity"},"Количество",-1))]),t("div",Wt,[u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.dealForm.total_price=l),type:"number",step:"0.01",class:"form-control",id:"total_price",placeholder:"Сумма",required:""},null,512),[[f,s.dealForm.total_price]]),e[28]||(e[28]=t("label",{for:"total_price"},"Сумма сделки",-1))]),e[29]||(e[29]=t("button",{type:"submit",class:"btn btn-success w-100 p-3"},"Подтвердить",-1))],32)])])])]),t("div",Xt,[t("div",Yt,[t("div",Zt,[e[36]||(e[36]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Подтверждение оплаты"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",xt,[t("form",{onSubmit:e[7]||(e[7]=b((...l)=>s.confirmPayment&&s.confirmPayment(...l),["prevent"]))},[t("div",es,[u(t("select",{class:"form-select","onUpdate:modelValue":e[5]||(e[5]=l=>s.paymentConfirmForm.payment_type=l),id:"payment-type","aria-label":"Floating label select example"},[...e[31]||(e[31]=[t("option",{value:"0"},"Наличный расчет",-1),t("option",{value:"1"},"Безналичный расчет",-1)])],512),[[w,s.paymentConfirmForm.payment_type]]),e[32]||(e[32]=t("label",{for:"payment-type"},"Тип оплаты",-1))]),s.paymentConfirmForm.payment_type==="1"?(i(),n("div",ts,[t("div",ss,[e[34]||(e[34]=t("h6",null,"Фотография чека",-1)),t("div",ls,[t("input",{type:"file",class:"form-control",onChange:e[6]||(e[6]=(...l)=>s.onFileChange&&s.onFileChange(...l)),accept:".jpg,.png,.pdf",required:""},null,32),e[33]||(e[33]=t("label",{for:"payment-type"},"Прикрепить",-1))])])])):a("",!0),e[35]||(e[35]=t("button",{type:"submit",class:"btn btn-success w-100 p-3"},"Подтвердить",-1))],32)])])])])],64))}}),bs=O(is,[["__scopeId","data-v-b76f2972"]]);export{bs as S};
