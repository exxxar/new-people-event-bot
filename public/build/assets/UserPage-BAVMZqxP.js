import{c as d,o,a as t,f,t as m,F as h,d as a,r as U,w as u,e as p,j as k,v as T,G as D,g,b as y,h as w}from"./app-BFXy5JVw.js";import{U as j}from"./UserForm-LNSJeRlo.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as N}from"./Pagination-BEOn-jB3.js";import{u as L}from"./users-DgYKCs5C.js";import{u as P}from"./useConfitmModalStore-3K6mUG_C.js";import{B as R}from"./BackBtn-DOVCGk6m.js";import"./makeAxiosFactory-B9aoRd9L.js";const O={name:"UserCard",props:{user:{type:Object,required:!0}},methods:{roleName(l){switch(l){case 0:return"Пользователь";case 1:return"Младший администратор";case 2:return"Поставщик";case 3:return"Администратор";case 4:return"Суперадмин";default:return"Неизвестно"}}}},A={class:"list-group list-group-flush"},q={class:"list-group-item"},z={class:"list-group-item"},W={class:"list-group-item"},G={class:"list-group-item"},H={class:"list-group-item"},J={class:"list-group-item"};function K(l,e,s,r,i,b){return o(),d(h,null,[t("ul",A,[t("li",q,[e[1]||(e[1]=t("strong",null,"Имя в системе:",-1)),f(" "+m(s.user.name),1)]),t("li",z,[e[2]||(e[2]=t("strong",null,"Имя из Telegram:",-1)),f(" "+m(s.user.fio_from_telegram||"не указано"),1)]),t("li",W,[e[3]||(e[3]=t("strong",null,"Email:",-1)),f(" "+m(s.user.email),1)]),t("li",G,[e[4]||(e[4]=t("strong",null,"Telegram Chat ID:",-1)),f(" "+m(s.user.telegram_chat_id||"не указан"),1)]),t("li",H,[e[5]||(e[5]=t("strong",null,"Роль:",-1)),f(" "+m(b.roleName(s.user.role)),1)]),t("li",J,[e[6]||(e[6]=t("strong",null,"Процент:",-1)),f(" "+m(s.user.percent)+"% ",1)])]),t("button",{class:"btn btn-primary w-100 p-3",onClick:e[0]||(e[0]=n=>l.$emit("edit",s.user))},"Редактировать")],64)}const Q=S(O,[["render",K]]),X={name:"UserFilter",data(){return{field_visible:[],filters:{name:"",fio_from_telegram:"",email:"",telegram_chat_id:"",role:"",percent:"",is_work:!1,email_verified:!1,blocked:!1},sort:{field:"id",direction:"asc"},sortableFields:{id:"№",name:"Имя",fio_from_telegram:"ФИО из Telegram",email:"Электронная почта",telegram_chat_id:"ID чата Telegram",role:"Роль",percent:"Процент",is_work:"Работает(да\\нет)",email_verified_at:"Дата подтверждения email",blocked_at:"Дата блокировки",created_at:"Дата создания",updated_at:"Дата обновления данных"}}},created(){let l=["name","email"];for(const e in this.sortableFields)this.field_visible[e]=l.indexOf(e)!==-1},methods:{openFilter(){new bootstrap.Modal(document.getElementById("userFilterModal")).show()},changeSort(l){this.sort.field===l?this.sort.direction=this.sort.direction==="asc"?"desc":"asc":(this.sort.field=l,this.sort.direction="asc");const e={filters:this.filters,sort:this.sort};this.$emit("apply-filters",e)},applyFilters(){const l={filters:this.filters,sort:this.sort,field_visible:this.field_visible};this.$emit("apply-filters",l),bootstrap.Modal.getInstance(document.getElementById("userFilterModal")).hide()}}},Y={class:"d-flex mb-2"},Z={class:"dropdown d-inline-block ms-2"},x={style:{"font-size":"12px"},class:"btn btn-outline-secondary",type:"button","data-bs-toggle":"dropdown"},ee={key:0},te={key:1},se={key:2},le={class:"dropdown-menu"},oe=["onClick"],ie={class:"modal fade",id:"userFilterModal",tabindex:"-1"},re={class:"modal-dialog"},de={class:"modal-content"},ne={class:"modal-body"},ae={class:"form-floating mb-2"},me={class:"form-floating mb-2"},ce={class:"form-floating mb-2"},ue={class:"form-floating mb-2"},pe={class:"form-floating mb-2"},fe={class:"form-floating mb-2"},be={class:"form-check mb-2"},ve={class:"form-check mb-2"},he={class:"form-check mb-2"},_e=["onUpdate:modelValue","id"],ke=["for"];function ge(l,e,s,r,i,b){return o(),d("div",null,[t("div",Y,[t("button",{style:{"font-size":"12px"},class:"btn btn-secondary",onClick:e[0]||(e[0]=(...n)=>b.openFilter&&b.openFilter(...n))},"Фильтр"),t("div",Z,[t("button",x,[f(m(i.sortableFields[i.sort.field].slice(0,17))+" ",1),i.sortableFields[i.sort.field].length>17?(o(),d("span",ee,"...")):a("",!0),e[13]||(e[13]=f(" (",-1)),i.sort.direction==="asc"?(o(),d("span",te,[...e[11]||(e[11]=[t("i",{class:"fa-solid fa-arrow-down"},null,-1)])])):a("",!0),i.sort.direction==="desc"?(o(),d("span",se,[...e[12]||(e[12]=[t("i",{class:"fa-solid fa-arrow-up"},null,-1)])])):a("",!0),e[14]||(e[14]=f(") ",-1))]),t("ul",le,[(o(!0),d(h,null,U(i.sortableFields,(n,c)=>(o(),d("li",{key:c},[t("a",{class:"dropdown-item",onClick:_=>b.changeSort(c)},m(n),9,oe)]))),128))])])]),t("div",ie,[t("div",re,[t("div",de,[t("form",{onSubmit:e[10]||(e[10]=u((...n)=>b.applyFilters&&b.applyFilters(...n),["prevent"]))},[e[26]||(e[26]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Фильтры пользователей"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ne,[t("div",ae,[p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>i.filters.name=n),class:"form-control",id:"nameInput",placeholder:"Имя"},null,512),[[k,i.filters.name]]),e[15]||(e[15]=t("label",{for:"nameInput"},"Имя",-1))]),t("div",me,[p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>i.filters.fio_from_telegram=n),class:"form-control",id:"fioInput",placeholder:"ФИО из Telegram"},null,512),[[k,i.filters.fio_from_telegram]]),e[16]||(e[16]=t("label",{for:"fioInput"},"ФИО из Telegram",-1))]),t("div",ce,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>i.filters.email=n),class:"form-control",id:"emailInput",placeholder:"Email"},null,512),[[k,i.filters.email]]),e[17]||(e[17]=t("label",{for:"emailInput"},"Email",-1))]),t("div",ue,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>i.filters.telegram_chat_id=n),class:"form-control",id:"tgInput",placeholder:"Telegram chat id"},null,512),[[k,i.filters.telegram_chat_id]]),e[18]||(e[18]=t("label",{for:"tgInput"},"Telegram chat id",-1))]),t("div",pe,[p(t("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>i.filters.role=n),class:"form-select",id:"roleSelect"},[...e[19]||(e[19]=[D('<option value="">Все</option><option value="0">Пользователь</option><option value="1">Младший администратор</option><option value="2">Поставщик</option><option value="3">Администратор</option><option value="4">Суперадмин</option>',6)])],512),[[T,i.filters.role]]),e[20]||(e[20]=t("label",{for:"roleSelect"},"Роль",-1))]),t("div",fe,[p(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=n=>i.filters.percent=n),class:"form-control",id:"percentInput",placeholder:"Процент"},null,512),[[k,i.filters.percent]]),e[21]||(e[21]=t("label",{for:"percentInput"},"Процент",-1))]),t("div",be,[p(t("input",{class:"form-check-input",type:"checkbox",id:"isWorkCheck","onUpdate:modelValue":e[7]||(e[7]=n=>i.filters.is_work=n)},null,512),[[g,i.filters.is_work]]),e[22]||(e[22]=t("label",{class:"form-check-label",for:"isWorkCheck"},"Работает",-1))]),t("div",ve,[p(t("input",{class:"form-check-input",type:"checkbox",id:"verifiedCheck","onUpdate:modelValue":e[8]||(e[8]=n=>i.filters.email_verified=n)},null,512),[[g,i.filters.email_verified]]),e[23]||(e[23]=t("label",{class:"form-check-label",for:"verifiedCheck"},"Email подтверждён",-1))]),t("div",he,[p(t("input",{class:"form-check-input",type:"checkbox",id:"blockedCheck","onUpdate:modelValue":e[9]||(e[9]=n=>i.filters.blocked=n)},null,512),[[g,i.filters.blocked]]),e[24]||(e[24]=t("label",{class:"form-check-label",for:"blockedCheck"},"Заблокирован",-1))]),e[25]||(e[25]=t("h6",null,"Отображаемые поля",-1)),(o(!0),d(h,null,U(i.sortableFields,(n,c)=>(o(),d("div",{key:c,class:"form-check form-switch mb-2"},[p(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":_=>i.field_visible[c]=_,id:`switch-${c}`},null,8,_e),[[g,i.field_visible[c]]]),t("label",{class:"form-check-label",for:`switch-${c}`},m(n),9,ke)]))),128))]),e[27]||(e[27]=t("div",{class:"modal-footer"},[t("button",{type:"submit",class:"btn btn-primary"},"Применить")],-1))],32)])])])])}const ye=S(X,[["render",ge]]),Ue={class:"list-group"},we={class:"fw-bold"},Se={key:0},Ce={key:1},Fe={key:0,class:"text-muted small mb-0"},Me={class:"text-primary fw-bold"},Ie={key:1,class:"text-muted small mb-0"},Ve={key:2,class:"text-muted small mb-0"},$e={key:3,class:"text-muted small mb-0"},Be=["onClick"],Ee={key:4,class:"text-muted small mb-0"},je={key:5,class:"text-muted small mb-0"},Te={key:6,class:"text-muted small mb-0"},De={key:7,class:"text-muted small mb-0"},Ne={key:8,class:"text-muted small mb-0"},Le={key:9,class:"text-muted small mb-0"},Pe={key:10,class:"text-muted small mb-0"},Re={class:"dropdown"},Oe={class:"dropdown-menu dropdown-menu-end"},Ae=["onClick"],qe=["onClick"],ze=["onClick"],We=["onClick"],Ge=["onClick"],He=["onClick"],Je={key:1},Ke=["onClick"],Qe={key:2},Xe=["onClick"],Ye={key:1,class:"alert alert-light mt-3"},Ze={class:"modal fade",id:"editUserModal",tabindex:"-1"},xe={class:"modal-dialog modal-lg"},et={class:"modal-content"},tt={class:"modal-body"},st={class:"modal fade",id:"editUserModal",tabindex:"-1"},lt={class:"modal-dialog modal-lg"},ot={class:"modal-content"},it={class:"modal-body"},rt={class:"modal fade",id:"roleSwitcherUserModal",tabindex:"-1"},dt={class:"modal-dialog modal-lg"},nt={class:"modal-content"},at={class:"modal-body"},mt={class:"form-floating mb-2"},ct={class:"modal fade",id:"viewUserModal",tabindex:"-1"},ut={class:"modal-dialog"},pt={class:"modal-content"},ft={class:"modal-body"},bt={name:"UserList",props:["forSelect"],data(){return{roles:["Пользователь","Младший администратор","Поставщик","Администратор","Суперадмин"],modalStore:P(),usersStore:L(),selectedUser:null,field_visible:null}},created(){this.fetchUsers()},methods:{async fetchUsers(l=1){await this.usersStore.fetchAllByPage(l)},async getTelegramLink(l){await this.usersStore.getTelegramLink(l.id)},async fetchUsersByUrl(l){await this.usersStore.fetchByUrl(l)},applyFilter(l){this.field_visible=l.field_visible,console.log("test",this.field_visible),this.usersStore.setFilters(l.filters),this.usersStore.setSort(l.sort.field,l.sort.direction),this.usersStore.fetchFiltered()},openRoleSwitcher(l){this.selectedUser=l,new bootstrap.Modal(document.getElementById("roleSwitcherUserModal")).show()},openEdit(l){this.selectedUser=l;const e=bootstrap.Modal.getInstance(document.getElementById("viewUserModal"));e&&e.hide(),new bootstrap.Modal(document.getElementById("editUserModal")).show()},confirmDelete(l){var e;this.selectedUser=l,this.modalStore.open(`Вы уверены, что хотите удалить ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.remove(this.selectedUser.id),()=>this.modalStore.close())},confirmUnBlocked(l){var e;this.selectedUser=l,this.modalStore.open(`Вы уверены, что хотите разблокировать ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.unblock(this.selectedUser.id),()=>this.modalStore.close())},confirmBlocked(l){var e;this.selectedUser=l,this.modalStore.open(`Вы уверены, что хотите заблокировать ${(e=this.selectedUser)==null?void 0:e.name}?`,()=>this.usersStore.block(this.selectedUser.id,""),()=>this.modalStore.close())},openView(l){this.selectedUser=l,new bootstrap.Modal(document.getElementById("viewUserModal")).show()},async changeRole(){await this.usersStore.updateRole(this.selectedUser.id,this.selectedUser.role);const l=bootstrap.Modal.getInstance(document.getElementById("roleSwitcherUserModal"));l&&l.hide()}}},vt=Object.assign(bt,{setup(l){return(e,s)=>(o(),d(h,null,[l.forSelect?a("",!0):(o(),y(ye,{key:0,onApplyFilters:e.applyFilter},null,8,["onApplyFilters"])),t("ul",Ue,[(o(!0),d(h,null,U(e.usersStore.items,r=>{var i,b,n,c,_,C,F,M,I,V,$,B,E;return o(),d("li",{key:r.id,class:"list-group-item d-flex justify-content-between align-items-center"},[t("div",null,[t("div",we,[((i=e.field_visible)!=null&&i.name,o(),d("span",Se,m(r.name),1)),(b=e.field_visible)!=null&&b.id?(o(),d("span",Ce,"(#"+m(r.id)+")",1)):a("",!0)]),((n=e.field_visible)!=null&&n.role,o(),d("p",Fe,[s[2]||(s[2]=f("Роль ",-1)),t("span",Me,m(e.roles.at(r.role||0)),1)])),(c=e.field_visible)!=null&&c.email?(o(),d("p",Ie,"Почта "+m(r.email),1)):a("",!0),((_=e.field_visible)!=null&&_.phone,o(),d("p",Ve,"Телефон "+m(r.phone||"-"),1)),(C=e.field_visible)!=null&&C.telegram_chat_id?(o(),d("p",$e,[s[3]||(s[3]=f(" ТГ id ",-1)),t("a",{href:"javascript:void(0)",onClick:u(v=>e.getTelegramLink(r),["prevent"])},m(r.telegram_chat_id||"Не указано"),9,Be)])):a("",!0),(F=e.field_visible)!=null&&F.role?(o(),d("p",Ee,m(e.roles[r.role||0]||"неизвестная роль"),1)):a("",!0),(M=e.field_visible)!=null&&M.percent?(o(),d("p",je,"Процент за работу "+m(r.percent)+"%",1)):a("",!0),(I=e.field_visible)!=null&&I.is_work?(o(),d("p",Te,"Статус работы "+m(r.is_work?"работает":"не работает"),1)):a("",!0),(V=e.field_visible)!=null&&V.email_verified_at?(o(),d("p",De,"Дата верификации почты "+m(r.email_verified_at),1)):a("",!0),($=e.field_visible)!=null&&$.blocked_at?(o(),d("p",Ne,"Дата блокировки "+m(r.blocked_at),1)):a("",!0),(B=e.field_visible)!=null&&B.created_at?(o(),d("p",Le,"Дата создания пользователя "+m(r.created_at),1)):a("",!0),(E=e.field_visible)!=null&&E.updated_at?(o(),d("p",Pe,"Дата последнего обновления данных пользователя "+m(r.updated_at),1)):a("",!0)]),t("div",Re,[s[7]||(s[7]=t("button",{class:"btn btn-sm",type:"button","data-bs-toggle":"dropdown"},[t("i",{class:"fas fa-bars"})],-1)),t("ul",Oe,[l.forSelect?(o(),d(h,{key:0},[t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.$emit("select",r),["prevent"])},"Выбрать",8,Ae)]),s[4]||(s[4]=t("li",null,[t("hr",{class:"dropdown-divider"})],-1))],64)):a("",!0),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openRoleSwitcher(r),["prevent"])},"Сменить роль",8,qe)]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openEdit(r),["prevent"])},"Редактировать",8,ze)]),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.openView(r),["prevent"])},"Просмотреть",8,We)]),s[5]||(s[5]=t("hr",{class:"dropdown-divider"},null,-1)),t("li",null,[t("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:u(v=>e.getTelegramLink(r),["prevent"])},"Получить ссылку на телеграм",8,Ge)]),s[6]||(s[6]=t("hr",{class:"dropdown-divider"},null,-1)),t("li",null,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmDelete(r),["prevent"])},"Удалить",8,He)]),r.blocked_at?a("",!0):(o(),d("li",Je,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmBlocked(r),["prevent"])},"Заблокировать",8,Ke)])),r.blocked_at?(o(),d("li",Qe,[t("a",{class:"dropdown-item text-danger",href:"javascript:void(0)",onClick:u(v=>e.confirmUnBlocked(r),["prevent"])},"Разблокировать",8,Xe)])):a("",!0)])])])}),128))]),w(N,{pagination:e.usersStore.pagination,onPageChanged:e.fetchUsersByUrl},null,8,["pagination","onPageChanged"]),e.usersStore.items.length===0?(o(),d("div",Ye," Пользователей пока нет. ")):a("",!0),t("div",Ze,[t("div",xe,[t("div",et,[s[8]||(s[8]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование пользователя"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",tt,[e.selectedUser?(o(),y(j,{key:0,initialData:e.selectedUser,onSaved:e.fetchUsers},null,8,["initialData","onSaved"])):a("",!0)])])])]),t("div",st,[t("div",lt,[t("div",ot,[s[9]||(s[9]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование пользователя"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",it,[e.selectedUser?(o(),y(j,{key:0,initialData:e.selectedUser,onSaved:e.fetchUsers},null,8,["initialData","onSaved"])):a("",!0)])])])]),t("div",rt,[t("div",dt,[t("div",nt,[s[13]||(s[13]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Редактирование роли"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",at,[e.selectedUser?(o(),d("form",{key:0,onSubmit:s[1]||(s[1]=u((...r)=>e.changeRole&&e.changeRole(...r),["prevent"]))},[t("div",mt,[p(t("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>e.selectedUser.role=r),class:"form-select",id:"role",required:""},[...s[10]||(s[10]=[t("option",{value:0},"Пользователь",-1),t("option",{value:1},"Младший администратор",-1),t("option",{value:2},"Поставщик",-1),t("option",{value:3},"Администратор",-1),t("option",{value:4},"Суперадмин",-1)])],512),[[T,e.selectedUser.role]]),s[11]||(s[11]=t("label",{for:"role"},"Роль",-1))]),s[12]||(s[12]=t("button",{type:"submit",class:"btn btn-primary w-100 p-3"}," Сохранить изменения ",-1))],32)):a("",!0)])])])]),t("div",ct,[t("div",ut,[t("div",pt,[s[14]||(s[14]=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"Информация о пользователе"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"})],-1)),t("div",ft,[e.selectedUser?(o(),y(Q,{key:0,user:e.selectedUser,onEdit:e.openEdit},null,8,["user","onEdit"])):a("",!0)])])])])],64))}}),ht=S(vt,[["__scopeId","data-v-7226c9e3"]]),_t={class:"container-fluid p-3"},kt={},It=Object.assign(kt,{__name:"UserPage",setup(l){return(e,s)=>(o(),d("div",_t,[w(R),s[0]||(s[0]=t("h4",{class:"mb-3"},"Список пользователей",-1)),w(ht)]))}});export{It as default};
