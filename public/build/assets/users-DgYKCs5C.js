import{i as d,I as l}from"./app-BFXy5JVw.js";import{m as e}from"./makeAxiosFactory-B9aoRd9L.js";const r="/bot-api/users",m=d("users",{state:()=>({items:[],self:null,loading:!1,error:null}),getters:{byId:t=>s=>t.items.find(i=>i.id===s)},actions:{setRole(t){this.self.role=t},async fetchSelf(){this.loading=!0,this.error=null;try{const{data:t}=await e(`${r}/self`,"POST");this.self=t}catch(t){this.error=(t==null?void 0:t.message)||"Failed to load agents"}finally{this.loading=!1}return!0},async fetchFiltered(t=1){var s,i;this.loading=!0,this.error=null;try{const a=new URLSearchParams;Object.entries(this.filters).forEach(([c,o])=>{o!=null&&o!==""&&o!==!1&&a.append(c,String(o))}),a.append("sort_field",this.sort.field),a.append("sort_direction",this.sort.direction),a.append("page",String(t));const{data:n}=await e(`${r}?${a.toString()}`,"GET");this.items=n.data,this.pagination=n}catch(a){this.error=((i=(s=a.response)==null?void 0:s.data)==null?void 0:i.message)??"Ошибка загрузки пользователей"}finally{this.loading=!1}},setFilters(t){this.filters=t},setSort(t,s){this.sort={field:t,direction:s}},async fetchAll(){this.loading=!0,this.error=null;try{const{data:t}=await e(`${r}`,"GET");this.items=t.data,console.log("data=>",t)}catch(t){this.error=(t==null?void 0:t.message)||"Failed to load users"}finally{this.loading=!1}},async fetchAllByPage(t=1){const{data:s}=await e(`${r}?page=${t}`,"GET");this.items=s.data,this.pagination=s},async fetchByUrl(t){const{data:s}=await e(t,"GET");this.items=s.data,this.pagination=s},async fetchOne(t){try{const{data:s}=await e(`${r}/${t}`,"GET");return s}catch(s){throw this.error=(s==null?void 0:s.message)||"Failed to load user",s}},async createPrimary(t){const{data:s}=await e(`${r}/primary`,"POST",t);return this.items.push(s),s},async create(t){const{data:s}=await e(`${r}`,"POST",t);return this.items.push(s),s},async update(t,s){const{data:i}=await e(`${r}/${t}`,"PUT",s),a=this.items.findIndex(n=>n.id===t);return a!==-1&&(this.items[a]=i),i},async remove(t){await e(`${r}/${t}`,"DELETE"),this.items=this.items.filter(s=>s.id!==t)},async getTelegramLink(t){await e(`${r}/${t}/tg`,"GET")},async updateRole(t,s){const{data:i}=await e(`${r}/${t}/role`,"POST",{role:s}),a=this.items.findIndex(n=>n.id===t);return a!==-1&&(this.items[a]=i),i},async updatePercent(t,s){const{data:i}=await e(`${r}/${t}/percent`,"PATCH",{percent:s}),a=this.items.findIndex(n=>n.id===t);return a!==-1&&(this.items[a]=i),i},async updateWorkStatus(t,s){const i=l(),{data:a}=await e(`${r}/${t}/work-status`,"POST",{is_work:s});i.show("Статус успешно обновлен");const n=this.items.findIndex(c=>c.id===t);return n!==-1&&(this.items[n]=a),a},async block(t,s){const{data:i}=await e(`${r}/${t}/block`,"PATCH",{blocked_message:s}),a=this.items.findIndex(n=>n.id===t);return a!==-1&&(this.items[a]=i),i},async unblock(t){const{data:s}=await e(`${r}/${t}/unblock`,"PATCH"),i=this.items.findIndex(a=>a.id===t);return i!==-1&&(this.items[i]=s),s}}});export{m as u};
